2021-09-24 14:48:20.529 INFO  org.hibernate.validator.internal.util.Version     :21   [32m                  [0;39m HV000001: Hibernate Validator 6.2.0.Final
2021-09-24 14:48:20.539 INFO  com.orange_yishenggong.wiki.config.WikiApplication:55   [32m                  [0;39m Starting WikiApplication using Java 16.0.1 on LAPTOP-GE9IV29P with PID 19884 (C:\Users\Orange Meow\IdeaProjects\wiki\target\classes started by Orange Meow in C:\Users\Orange Meow\IdeaProjects\wiki)
2021-09-24 14:48:20.540 INFO  com.orange_yishenggong.wiki.config.WikiApplication:663  [32m                  [0;39m No active profile set, falling back to default profiles: default
2021-09-24 14:48:21.569 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :262  [32m                  [0;39m Multiple Spring Data modules found, entering strict repository configuration mode!
2021-09-24 14:48:21.573 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :132  [32m                  [0;39m Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2021-09-24 14:48:21.604 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :201  [32m                  [0;39m Finished Spring Data repository scanning in 9 ms. Found 0 Redis repository interfaces.
2021-09-24 14:48:22.501 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :108  [32m                  [0;39m Tomcat initialized with port(s): 8888 (http)
2021-09-24 14:48:22.513 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Initializing ProtocolHandler ["http-nio-8888"]
2021-09-24 14:48:22.514 INFO  org.apache.catalina.core.StandardService          :173  [32m                  [0;39m Starting service [Tomcat]
2021-09-24 14:48:22.515 INFO  org.apache.catalina.core.StandardEngine           :173  [32m                  [0;39m Starting Servlet engine: [Apache Tomcat/9.0.46]
2021-09-24 14:48:22.658 INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] :173  [32m                  [0;39m Initializing Spring embedded WebApplicationContext
2021-09-24 14:48:22.659 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext    :290  [32m                  [0;39m Root WebApplicationContext: initialization completed in 2053 ms
2021-09-24 14:48:24.489 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Starting ProtocolHandler ["http-nio-8888"]
2021-09-24 14:48:24.542 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :220  [32m                  [0;39m Tomcat started on port(s): 8888 (http) with context path ''
2021-09-24 14:48:24.559 INFO  com.orange_yishenggong.wiki.config.WikiApplication:61   [32m                  [0;39m Started WikiApplication in 4.672 seconds (JVM running for 5.573)
2021-09-24 14:48:24.560 INFO  o.s.boot.availability.ApplicationAvailabilityBean :75   [32m                  [0;39m Application availability state LivenessState changed to CORRECT
2021-09-24 14:48:24.562 INFO  o.s.boot.availability.ApplicationAvailabilityBean :75   [32m                  [0;39m Application availability state ReadinessState changed to ACCEPTING_TRAFFIC
2021-09-24 14:48:24.563 INFO  com.orange_yishenggong.wiki.config.WikiApplication:23   [32m                  [0;39m 启动成功	:)
2021-09-24 14:48:24.563 INFO  com.orange_yishenggong.wiki.config.WikiApplication:24   [32m                  [0;39m 地址:	http://127.0.0.1:8888
2021-09-24 14:48:30.006 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377711984743424   [0;39m 更新电子书下的文档数据开始
2021-09-24 14:48:30.036 INFO  com.zaxxer.hikari.HikariDataSource                :110  [32m377711984743424   [0;39m HikariPool-1 - Starting...
2021-09-24 14:48:30.493 INFO  com.zaxxer.hikari.HikariDataSource                :123  [32m377711984743424   [0;39m HikariPool-1 - Start completed.
2021-09-24 14:48:30.504 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377711984743424   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 14:48:30.532 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377711984743424   [0;39m ==> Parameters: 
2021-09-24 14:48:30.542 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377711984743424   [0;39m <==    Updates: 4
2021-09-24 14:48:30.544 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377711984743424   [0;39m 更新电子书下的文档数据结束，耗时：537毫秒
2021-09-24 14:48:35.006 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377712066663424   [0;39m 生成今日电子书快照开始
2021-09-24 14:48:35.008 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377712066663424   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 14:48:35.010 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377712066663424   [0;39m ==> Parameters: 
2021-09-24 14:48:35.031 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377712066663424   [0;39m <==    Updates: 17
2021-09-24 14:48:35.032 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377712066663424   [0;39m 生成今日电子书快照结束，耗时：24毫秒
2021-09-24 14:49:00.007 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377712476279808   [0;39m 更新电子书下的文档数据开始
2021-09-24 14:49:00.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377712476279808   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 14:49:00.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377712476279808   [0;39m ==> Parameters: 
2021-09-24 14:49:00.011 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377712476279808   [0;39m <==    Updates: 4
2021-09-24 14:49:00.011 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377712476279808   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 14:49:02.390 INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] :173  [32m                  [0;39m Initializing Spring DispatcherServlet 'dispatcherServlet'
2021-09-24 14:49:02.391 INFO  org.springframework.web.servlet.DispatcherServlet :525  [32m                  [0;39m Initializing Servlet 'dispatcherServlet'
2021-09-24 14:49:02.392 INFO  org.springframework.web.servlet.DispatcherServlet :547  [32m                  [0;39m Completed initialization in 1 ms
2021-09-24 14:49:02.428 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :55   [32m377712515912704   [0;39m ------------- 开始 -------------
2021-09-24 14:49:02.429 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :56   [32m377712515912704   [0;39m 请求地址: http://localhost:8888/category/all GET
2021-09-24 14:49:02.429 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :57   [32m377712515912704   [0;39m 类名方法: com.orange_yishenggong.wiki.controller.CategoryController.all
2021-09-24 14:49:02.430 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :58   [32m377712515912704   [0;39m 远程地址: 0:0:0:0:0:0:0:1
2021-09-24 14:49:02.440 INFO  c.o.wiki.websocket.WebSocketServer                :32   [32m                  [0;39m 有新连接：token：c3T2YgWBbj，session id：0，当前连接数：1
2021-09-24 14:49:02.475 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :80   [32m377712515912704   [0;39m 请求参数: []
2021-09-24 14:49:02.498 DEBUG c.o.wiki.mapper.CategoryMapper.selectByExample    :137  [32m377712515912704   [0;39m ==>  Preparing: select id, parent, `name`, sort from category order by sort asc
2021-09-24 14:49:02.499 DEBUG c.o.wiki.mapper.CategoryMapper.selectByExample    :137  [32m377712515912704   [0;39m ==> Parameters: 
2021-09-24 14:49:02.525 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377712515912704   [0;39m <==    Columns: id, parent, name, sort
2021-09-24 14:49:02.526 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377712515912704   [0;39m <==        Row: 100, 0, 前端开发, 100
2021-09-24 14:49:02.528 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377712515912704   [0;39m <==        Row: 101, 100, Vue, 101
2021-09-24 14:49:02.528 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377712515912704   [0;39m <==        Row: 102, 100, Html, 102
2021-09-24 14:49:02.529 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377712515912704   [0;39m <==        Row: 200, 0, Java, 200
2021-09-24 14:49:02.529 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377712515912704   [0;39m <==        Row: 300, 0, MySql, 200
2021-09-24 14:49:02.529 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377712515912704   [0;39m <==        Row: 201, 200, 基础应用, 201
2021-09-24 14:49:02.530 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377712515912704   [0;39m <==        Row: 202, 200, 框架应用, 202
2021-09-24 14:49:02.530 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377712515912704   [0;39m <==        Row: 301, 300, 数据分析师, 301
2021-09-24 14:49:02.531 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377712515912704   [0;39m <==        Row: 302, 300, 数据工程师, 302
2021-09-24 14:49:02.531 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377712515912704   [0;39m <==        Row: 400, 0, 郭毛毛, 400
2021-09-24 14:49:02.531 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377712515912704   [0;39m <==        Row: 310978500236288, 400, 郭毛毛的大哥, 401
2021-09-24 14:49:02.531 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377712515912704   [0;39m <==        Row: 311011061306368, 400, 郭毛毛的二哥, 402
2021-09-24 14:49:02.532 DEBUG c.o.wiki.mapper.CategoryMapper.selectByExample    :137  [32m377712515912704   [0;39m <==      Total: 12
2021-09-24 14:49:02.564 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :92   [32m377712515912704   [0;39m 返回结果: {"content":[{"id":100,"name":"前端开发","parent":0,"sort":100},{"id":101,"name":"Vue","parent":100,"sort":101},{"id":102,"name":"Html","parent":100,"sort":102},{"id":200,"name":"Java","parent":0,"sort":200},{"id":300,"name":"MySql","parent":0,"sort":200},{"id":201,"name":"基础应用","parent":200,"sort":201},{"id":202,"name":"框架应用","parent":200,"sort":202},{"id":301,"name":"数据分析师","parent":300,"sort":301},{"id":302,"name":"数据工程师","parent":300,"sort":302},{"id":400,"name":"郭毛毛","parent":0,"sort":400},{"id":310978500236288,"name":"郭毛毛的大哥","parent":400,"sort":401},{"id":311011061306368,"name":"郭毛毛的二哥","parent":400,"sort":402}],"success":true}
2021-09-24 14:49:02.565 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :93   [32m377712515912704   [0;39m ------------- 结束 耗时：139 ms -------------
2021-09-24 14:49:05.001 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377712558101504   [0;39m 生成今日电子书快照开始
2021-09-24 14:49:05.002 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377712558101504   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 14:49:05.003 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377712558101504   [0;39m ==> Parameters: 
2021-09-24 14:49:05.006 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377712558101504   [0;39m <==    Updates: 0
2021-09-24 14:49:05.006 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377712558101504   [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-09-24 14:49:30.006 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377712967783424   [0;39m 更新电子书下的文档数据开始
2021-09-24 14:49:30.008 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377712967783424   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 14:49:30.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377712967783424   [0;39m ==> Parameters: 
2021-09-24 14:49:30.011 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377712967783424   [0;39m <==    Updates: 4
2021-09-24 14:49:30.011 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377712967783424   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 14:49:35.006 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377713049703424   [0;39m 生成今日电子书快照开始
2021-09-24 14:49:35.008 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377713049703424   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 14:49:35.010 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377713049703424   [0;39m ==> Parameters: 
2021-09-24 14:49:35.014 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377713049703424   [0;39m <==    Updates: 0
2021-09-24 14:49:35.014 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377713049703424   [0;39m 生成今日电子书快照结束，耗时：7毫秒
2021-09-24 14:50:00.005 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377713459287040   [0;39m 更新电子书下的文档数据开始
2021-09-24 14:50:00.007 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377713459287040   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 14:50:00.008 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377713459287040   [0;39m ==> Parameters: 
2021-09-24 14:50:00.010 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377713459287040   [0;39m <==    Updates: 4
2021-09-24 14:50:00.011 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377713459287040   [0;39m 更新电子书下的文档数据结束，耗时：5毫秒
2021-09-24 14:50:05.002 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377713541157888   [0;39m 生成今日电子书快照开始
2021-09-24 14:50:05.004 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377713541157888   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 14:50:05.005 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377713541157888   [0;39m ==> Parameters: 
2021-09-24 14:50:05.008 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377713541157888   [0;39m <==    Updates: 0
2021-09-24 14:50:05.009 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377713541157888   [0;39m 生成今日电子书快照结束，耗时：6毫秒
2021-09-24 14:50:30.002 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377713950757888   [0;39m 更新电子书下的文档数据开始
2021-09-24 14:50:30.004 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377713950757888   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 14:50:30.005 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377713950757888   [0;39m ==> Parameters: 
2021-09-24 14:50:30.007 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377713950757888   [0;39m <==    Updates: 4
2021-09-24 14:50:30.007 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377713950757888   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 14:50:35.006 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377714032743424   [0;39m 生成今日电子书快照开始
2021-09-24 14:50:35.008 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377714032743424   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 14:50:35.009 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377714032743424   [0;39m ==> Parameters: 
2021-09-24 14:50:35.012 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377714032743424   [0;39m <==    Updates: 0
2021-09-24 14:50:35.013 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377714032743424   [0;39m 生成今日电子书快照结束，耗时：6毫秒
2021-09-24 14:51:00.015 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377714442490880   [0;39m 更新电子书下的文档数据开始
2021-09-24 14:51:00.017 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377714442490880   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 14:51:00.017 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377714442490880   [0;39m ==> Parameters: 
2021-09-24 14:51:00.019 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377714442490880   [0;39m <==    Updates: 4
2021-09-24 14:51:00.020 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377714442490880   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 14:51:05.005 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377714524247040   [0;39m 生成今日电子书快照开始
2021-09-24 14:51:05.007 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377714524247040   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 14:51:05.027 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377714524247040   [0;39m ==> Parameters: 
2021-09-24 14:51:05.032 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377714524247040   [0;39m <==    Updates: 0
2021-09-24 14:51:05.033 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377714524247040   [0;39m 生成今日电子书快照结束，耗时：27毫秒
2021-09-24 14:51:30.001 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377714933781504   [0;39m 更新电子书下的文档数据开始
2021-09-24 14:51:30.003 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377714933781504   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 14:51:30.004 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377714933781504   [0;39m ==> Parameters: 
2021-09-24 14:51:30.006 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377714933781504   [0;39m <==    Updates: 4
2021-09-24 14:51:30.006 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377714933781504   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 14:51:35.009 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377715015832576   [0;39m 生成今日电子书快照开始
2021-09-24 14:51:35.012 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377715015832576   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 14:51:35.014 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377715015832576   [0;39m ==> Parameters: 
2021-09-24 14:51:35.016 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377715015832576   [0;39m <==    Updates: 0
2021-09-24 14:51:35.017 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377715015832576   [0;39m 生成今日电子书快照结束，耗时：7毫秒
2021-09-24 14:52:00.015 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377715425530880   [0;39m 更新电子书下的文档数据开始
2021-09-24 14:52:00.018 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377715425530880   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 14:52:00.019 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377715425530880   [0;39m ==> Parameters: 
2021-09-24 14:52:00.022 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377715425530880   [0;39m <==    Updates: 4
2021-09-24 14:52:00.023 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377715425530880   [0;39m 更新电子书下的文档数据结束，耗时：7毫秒
2021-09-24 14:52:05.005 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377715507287040   [0;39m 生成今日电子书快照开始
2021-09-24 14:52:05.007 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377715507287040   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 14:52:05.009 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377715507287040   [0;39m ==> Parameters: 
2021-09-24 14:52:05.011 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377715507287040   [0;39m <==    Updates: 0
2021-09-24 14:52:05.012 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377715507287040   [0;39m 生成今日电子书快照结束，耗时：7毫秒
2021-09-24 14:52:30.006 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377715916903424   [0;39m 更新电子书下的文档数据开始
2021-09-24 14:52:30.008 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377715916903424   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 14:52:30.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377715916903424   [0;39m ==> Parameters: 
2021-09-24 14:52:30.010 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377715916903424   [0;39m <==    Updates: 4
2021-09-24 14:52:30.010 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377715916903424   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 14:52:35.011 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377715998905344   [0;39m 生成今日电子书快照开始
2021-09-24 14:52:35.013 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377715998905344   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 14:52:35.015 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377715998905344   [0;39m ==> Parameters: 
2021-09-24 14:52:35.017 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377715998905344   [0;39m <==    Updates: 0
2021-09-24 14:52:35.017 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377715998905344   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 14:53:00.004 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377716408390656   [0;39m 更新电子书下的文档数据开始
2021-09-24 14:53:00.006 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377716408390656   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 14:53:00.007 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377716408390656   [0;39m ==> Parameters: 
2021-09-24 14:53:00.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377716408390656   [0;39m <==    Updates: 4
2021-09-24 14:53:00.009 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377716408390656   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 14:53:05.009 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377716490392576   [0;39m 生成今日电子书快照开始
2021-09-24 14:53:05.011 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377716490392576   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 14:53:05.013 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377716490392576   [0;39m ==> Parameters: 
2021-09-24 14:53:05.015 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377716490392576   [0;39m <==    Updates: 0
2021-09-24 14:53:05.016 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377716490392576   [0;39m 生成今日电子书快照结束，耗时：6毫秒
2021-09-24 14:53:30.006 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377716899943424   [0;39m 更新电子书下的文档数据开始
2021-09-24 14:53:30.012 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377716899943424   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 14:53:30.013 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377716899943424   [0;39m ==> Parameters: 
2021-09-24 14:53:30.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377716899943424   [0;39m <==    Updates: 4
2021-09-24 14:53:30.015 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377716899943424   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 14:53:35.009 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377716981912576   [0;39m 生成今日电子书快照开始
2021-09-24 14:53:35.011 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377716981912576   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 14:53:35.012 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377716981912576   [0;39m ==> Parameters: 
2021-09-24 14:53:35.015 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377716981912576   [0;39m <==    Updates: 0
2021-09-24 14:53:35.015 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377716981912576   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 14:54:00.013 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377717391578112   [0;39m 更新电子书下的文档数据开始
2021-09-24 14:54:00.015 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377717391578112   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 14:54:00.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377717391578112   [0;39m ==> Parameters: 
2021-09-24 14:54:00.022 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377717391578112   [0;39m <==    Updates: 4
2021-09-24 14:54:00.022 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377717391578112   [0;39m 更新电子书下的文档数据结束，耗时：8毫秒
2021-09-24 14:54:05.005 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377717473367040   [0;39m 生成今日电子书快照开始
2021-09-24 14:54:05.007 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377717473367040   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 14:54:05.008 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377717473367040   [0;39m ==> Parameters: 
2021-09-24 14:54:05.011 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377717473367040   [0;39m <==    Updates: 0
2021-09-24 14:54:05.011 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377717473367040   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 14:54:30.017 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377717883163648   [0;39m 更新电子书下的文档数据开始
2021-09-24 14:54:30.019 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377717883163648   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 14:54:30.019 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377717883163648   [0;39m ==> Parameters: 
2021-09-24 14:54:30.021 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377717883163648   [0;39m <==    Updates: 4
2021-09-24 14:54:30.021 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377717883163648   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 14:54:35.003 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377717964854272   [0;39m 生成今日电子书快照开始
2021-09-24 14:54:35.004 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377717964854272   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 14:54:35.005 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377717964854272   [0;39m ==> Parameters: 
2021-09-24 14:54:35.008 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377717964854272   [0;39m <==    Updates: 0
2021-09-24 14:54:35.008 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377717964854272   [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-09-24 14:55:00.003 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377718374454272   [0;39m 更新电子书下的文档数据开始
2021-09-24 14:55:00.005 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377718374454272   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 14:55:00.006 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377718374454272   [0;39m ==> Parameters: 
2021-09-24 14:55:00.008 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377718374454272   [0;39m <==    Updates: 4
2021-09-24 14:55:00.009 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377718374454272   [0;39m 更新电子书下的文档数据结束，耗时：5毫秒
2021-09-24 14:55:05.009 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377718456472576   [0;39m 生成今日电子书快照开始
2021-09-24 14:55:05.011 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377718456472576   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 14:55:05.012 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377718456472576   [0;39m ==> Parameters: 
2021-09-24 14:55:05.014 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377718456472576   [0;39m <==    Updates: 0
2021-09-24 14:55:05.015 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377718456472576   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 14:55:30.014 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377718866154496   [0;39m 更新电子书下的文档数据开始
2021-09-24 14:55:30.015 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377718866154496   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 14:55:30.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377718866154496   [0;39m ==> Parameters: 
2021-09-24 14:55:30.017 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377718866154496   [0;39m <==    Updates: 4
2021-09-24 14:55:30.018 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377718866154496   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 14:55:35.015 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377718948090880   [0;39m 生成今日电子书快照开始
2021-09-24 14:55:35.016 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377718948090880   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 14:55:35.018 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377718948090880   [0;39m ==> Parameters: 
2021-09-24 14:55:35.021 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377718948090880   [0;39m <==    Updates: 0
2021-09-24 14:55:35.022 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377718948090880   [0;39m 生成今日电子书快照结束，耗时：6毫秒
2021-09-24 14:56:00.004 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377719357510656   [0;39m 更新电子书下的文档数据开始
2021-09-24 14:56:00.006 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377719357510656   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 14:56:00.007 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377719357510656   [0;39m ==> Parameters: 
2021-09-24 14:56:00.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377719357510656   [0;39m <==    Updates: 4
2021-09-24 14:56:00.010 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377719357510656   [0;39m 更新电子书下的文档数据结束，耗时：5毫秒
2021-09-24 14:56:05.005 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377719439447040   [0;39m 生成今日电子书快照开始
2021-09-24 14:56:05.007 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377719439447040   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 14:56:05.008 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377719439447040   [0;39m ==> Parameters: 
2021-09-24 14:56:05.011 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377719439447040   [0;39m <==    Updates: 0
2021-09-24 14:56:05.011 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377719439447040   [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-09-24 14:56:30.009 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377719849112576   [0;39m 更新电子书下的文档数据开始
2021-09-24 14:56:30.010 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377719849112576   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 14:56:30.011 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377719849112576   [0;39m ==> Parameters: 
2021-09-24 14:56:30.012 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377719849112576   [0;39m <==    Updates: 4
2021-09-24 14:56:30.012 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377719849112576   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 14:56:35.004 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377719930950656   [0;39m 生成今日电子书快照开始
2021-09-24 14:56:35.006 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377719930950656   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 14:56:35.007 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377719930950656   [0;39m ==> Parameters: 
2021-09-24 14:56:35.010 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377719930950656   [0;39m <==    Updates: 0
2021-09-24 14:56:35.010 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377719930950656   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 14:57:00.000 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377720340485120   [0;39m 更新电子书下的文档数据开始
2021-09-24 14:57:00.002 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377720340485120   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 14:57:00.003 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377720340485120   [0;39m ==> Parameters: 
2021-09-24 14:57:00.005 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377720340485120   [0;39m <==    Updates: 4
2021-09-24 14:57:00.005 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377720340485120   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 14:57:05.013 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377720422618112   [0;39m 生成今日电子书快照开始
2021-09-24 14:57:05.015 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377720422618112   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 14:57:05.016 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377720422618112   [0;39m ==> Parameters: 
2021-09-24 14:57:05.018 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377720422618112   [0;39m <==    Updates: 0
2021-09-24 14:57:05.019 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377720422618112   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 14:57:30.002 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377720832037888   [0;39m 更新电子书下的文档数据开始
2021-09-24 14:57:30.003 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377720832037888   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 14:57:30.004 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377720832037888   [0;39m ==> Parameters: 
2021-09-24 14:57:30.005 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377720832037888   [0;39m <==    Updates: 4
2021-09-24 14:57:30.006 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377720832037888   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 14:57:35.010 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377720914088960   [0;39m 生成今日电子书快照开始
2021-09-24 14:57:35.011 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377720914088960   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 14:57:35.012 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377720914088960   [0;39m ==> Parameters: 
2021-09-24 14:57:35.015 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377720914088960   [0;39m <==    Updates: 0
2021-09-24 14:57:35.016 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377720914088960   [0;39m 生成今日电子书快照结束，耗时：6毫秒
2021-09-24 14:58:00.005 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377721323607040   [0;39m 更新电子书下的文档数据开始
2021-09-24 14:58:00.007 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377721323607040   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 14:58:00.008 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377721323607040   [0;39m ==> Parameters: 
2021-09-24 14:58:00.010 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377721323607040   [0;39m <==    Updates: 4
2021-09-24 14:58:00.011 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377721323607040   [0;39m 更新电子书下的文档数据结束，耗时：5毫秒
2021-09-24 14:58:05.008 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377721405576192   [0;39m 生成今日电子书快照开始
2021-09-24 14:58:05.010 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377721405576192   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 14:58:05.012 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377721405576192   [0;39m ==> Parameters: 
2021-09-24 14:58:05.014 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377721405576192   [0;39m <==    Updates: 0
2021-09-24 14:58:05.015 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377721405576192   [0;39m 生成今日电子书快照结束，耗时：6毫秒
2021-09-24 14:58:30.005 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377721815127040   [0;39m 更新电子书下的文档数据开始
2021-09-24 14:58:30.007 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377721815127040   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 14:58:30.007 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377721815127040   [0;39m ==> Parameters: 
2021-09-24 14:58:30.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377721815127040   [0;39m <==    Updates: 4
2021-09-24 14:58:30.009 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377721815127040   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 14:58:35.005 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377721897047040   [0;39m 生成今日电子书快照开始
2021-09-24 14:58:35.006 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377721897047040   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 14:58:35.007 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377721897047040   [0;39m ==> Parameters: 
2021-09-24 14:58:35.010 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377721897047040   [0;39m <==    Updates: 0
2021-09-24 14:58:35.010 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377721897047040   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 14:59:00.007 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377722306679808   [0;39m 更新电子书下的文档数据开始
2021-09-24 14:59:00.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377722306679808   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 14:59:00.010 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377722306679808   [0;39m ==> Parameters: 
2021-09-24 14:59:00.013 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377722306679808   [0;39m <==    Updates: 4
2021-09-24 14:59:00.013 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377722306679808   [0;39m 更新电子书下的文档数据结束，耗时：5毫秒
2021-09-24 14:59:05.010 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377722388648960   [0;39m 生成今日电子书快照开始
2021-09-24 14:59:05.011 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377722388648960   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 14:59:05.013 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377722388648960   [0;39m ==> Parameters: 
2021-09-24 14:59:05.015 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377722388648960   [0;39m <==    Updates: 0
2021-09-24 14:59:05.016 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377722388648960   [0;39m 生成今日电子书快照结束，耗时：6毫秒
2021-09-24 14:59:30.015 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377722798330880   [0;39m 更新电子书下的文档数据开始
2021-09-24 14:59:30.017 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377722798330880   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 14:59:30.017 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377722798330880   [0;39m ==> Parameters: 
2021-09-24 14:59:30.019 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377722798330880   [0;39m <==    Updates: 4
2021-09-24 14:59:30.019 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377722798330880   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 14:59:35.010 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377722880168960   [0;39m 生成今日电子书快照开始
2021-09-24 14:59:35.011 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377722880168960   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 14:59:35.012 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377722880168960   [0;39m ==> Parameters: 
2021-09-24 14:59:35.014 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377722880168960   [0;39m <==    Updates: 0
2021-09-24 14:59:35.015 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377722880168960   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:00:00.007 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377723289719808   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:00:00.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377723289719808   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:00:00.010 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377723289719808   [0;39m ==> Parameters: 
2021-09-24 15:00:00.020 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377723289719808   [0;39m <==    Updates: 4
2021-09-24 15:00:00.021 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377723289719808   [0;39m 更新电子书下的文档数据结束，耗时：13毫秒
2021-09-24 15:00:05.005 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377723371607040   [0;39m 生成今日电子书快照开始
2021-09-24 15:00:05.007 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377723371607040   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:00:05.008 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377723371607040   [0;39m ==> Parameters: 
2021-09-24 15:00:05.010 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377723371607040   [0;39m <==    Updates: 0
2021-09-24 15:00:05.011 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377723371607040   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:00:30.010 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377723781288960   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:00:30.012 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377723781288960   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:00:30.013 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377723781288960   [0;39m ==> Parameters: 
2021-09-24 15:00:30.015 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377723781288960   [0;39m <==    Updates: 4
2021-09-24 15:00:30.015 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377723781288960   [0;39m 更新电子书下的文档数据结束，耗时：5毫秒
2021-09-24 15:00:35.010 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377723863208960   [0;39m 生成今日电子书快照开始
2021-09-24 15:00:35.013 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377723863208960   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:00:35.015 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377723863208960   [0;39m ==> Parameters: 
2021-09-24 15:00:35.017 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377723863208960   [0;39m <==    Updates: 0
2021-09-24 15:00:35.018 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377723863208960   [0;39m 生成今日电子书快照结束，耗时：7毫秒
2021-09-24 15:01:00.001 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377724272661504   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:01:00.003 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377724272661504   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:01:00.004 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377724272661504   [0;39m ==> Parameters: 
2021-09-24 15:01:00.006 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377724272661504   [0;39m <==    Updates: 4
2021-09-24 15:01:00.007 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377724272661504   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:01:05.001 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377724354581504   [0;39m 生成今日电子书快照开始
2021-09-24 15:01:05.002 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377724354581504   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:01:05.003 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377724354581504   [0;39m ==> Parameters: 
2021-09-24 15:01:05.007 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377724354581504   [0;39m <==    Updates: 0
2021-09-24 15:01:05.007 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377724354581504   [0;39m 生成今日电子书快照结束，耗时：6毫秒
2021-09-24 15:01:30.013 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377724764378112   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:01:30.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377724764378112   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:01:30.015 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377724764378112   [0;39m ==> Parameters: 
2021-09-24 15:01:30.017 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377724764378112   [0;39m <==    Updates: 4
2021-09-24 15:01:30.017 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377724764378112   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:01:35.008 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377724846216192   [0;39m 生成今日电子书快照开始
2021-09-24 15:01:35.010 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377724846216192   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:01:35.010 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377724846216192   [0;39m ==> Parameters: 
2021-09-24 15:01:35.013 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377724846216192   [0;39m <==    Updates: 0
2021-09-24 15:01:35.013 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377724846216192   [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-09-24 15:02:00.006 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377725255783424   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:02:00.008 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377725255783424   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:02:00.008 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377725255783424   [0;39m ==> Parameters: 
2021-09-24 15:02:00.010 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377725255783424   [0;39m <==    Updates: 4
2021-09-24 15:02:00.010 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377725255783424   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 15:02:05.005 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377725337687040   [0;39m 生成今日电子书快照开始
2021-09-24 15:02:05.007 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377725337687040   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:02:05.008 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377725337687040   [0;39m ==> Parameters: 
2021-09-24 15:02:05.011 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377725337687040   [0;39m <==    Updates: 0
2021-09-24 15:02:05.011 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377725337687040   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:02:30.018 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377725747500032   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:02:30.020 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377725747500032   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:02:30.021 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377725747500032   [0;39m ==> Parameters: 
2021-09-24 15:02:30.023 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377725747500032   [0;39m <==    Updates: 4
2021-09-24 15:02:30.023 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377725747500032   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:02:35.012 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377725829321728   [0;39m 生成今日电子书快照开始
2021-09-24 15:02:35.016 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377725829321728   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:02:35.018 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377725829321728   [0;39m ==> Parameters: 
2021-09-24 15:02:35.021 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377725829321728   [0;39m <==    Updates: 0
2021-09-24 15:02:35.021 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377725829321728   [0;39m 生成今日电子书快照结束，耗时：7毫秒
2021-09-24 15:03:00.006 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377726238823424   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:03:00.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377726238823424   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:03:00.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377726238823424   [0;39m ==> Parameters: 
2021-09-24 15:03:00.011 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377726238823424   [0;39m <==    Updates: 4
2021-09-24 15:03:00.012 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377726238823424   [0;39m 更新电子书下的文档数据结束，耗时：5毫秒
2021-09-24 15:03:03.022 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :55   [32m377726288237568   [0;39m ------------- 开始 -------------
2021-09-24 15:03:03.023 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :56   [32m377726288237568   [0;39m 请求地址: http://localhost:8888/category/all GET
2021-09-24 15:03:03.024 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :57   [32m377726288237568   [0;39m 类名方法: com.orange_yishenggong.wiki.controller.CategoryController.all
2021-09-24 15:03:03.024 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :58   [32m377726288237568   [0;39m 远程地址: 0:0:0:0:0:0:0:1
2021-09-24 15:03:03.024 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :80   [32m377726288237568   [0;39m 请求参数: []
2021-09-24 15:03:03.026 DEBUG c.o.wiki.mapper.CategoryMapper.selectByExample    :137  [32m377726288237568   [0;39m ==>  Preparing: select id, parent, `name`, sort from category order by sort asc
2021-09-24 15:03:03.027 DEBUG c.o.wiki.mapper.CategoryMapper.selectByExample    :137  [32m377726288237568   [0;39m ==> Parameters: 
2021-09-24 15:03:03.028 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377726288237568   [0;39m <==    Columns: id, parent, name, sort
2021-09-24 15:03:03.028 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377726288237568   [0;39m <==        Row: 100, 0, 前端开发, 100
2021-09-24 15:03:03.029 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377726288237568   [0;39m <==        Row: 101, 100, Vue, 101
2021-09-24 15:03:03.030 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377726288237568   [0;39m <==        Row: 102, 100, Html, 102
2021-09-24 15:03:03.031 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377726288237568   [0;39m <==        Row: 200, 0, Java, 200
2021-09-24 15:03:03.033 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377726288237568   [0;39m <==        Row: 300, 0, MySql, 200
2021-09-24 15:03:03.034 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377726288237568   [0;39m <==        Row: 201, 200, 基础应用, 201
2021-09-24 15:03:03.034 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377726288237568   [0;39m <==        Row: 202, 200, 框架应用, 202
2021-09-24 15:03:03.035 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377726288237568   [0;39m <==        Row: 301, 300, 数据分析师, 301
2021-09-24 15:03:03.035 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377726288237568   [0;39m <==        Row: 302, 300, 数据工程师, 302
2021-09-24 15:03:03.035 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377726288237568   [0;39m <==        Row: 400, 0, 郭毛毛, 400
2021-09-24 15:03:03.036 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377726288237568   [0;39m <==        Row: 310978500236288, 400, 郭毛毛的大哥, 401
2021-09-24 15:03:03.036 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377726288237568   [0;39m <==        Row: 311011061306368, 400, 郭毛毛的二哥, 402
2021-09-24 15:03:03.037 DEBUG c.o.wiki.mapper.CategoryMapper.selectByExample    :137  [32m377726288237568   [0;39m <==      Total: 12
2021-09-24 15:03:03.040 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :92   [32m377726288237568   [0;39m 返回结果: {"content":[{"id":100,"name":"前端开发","parent":0,"sort":100},{"id":101,"name":"Vue","parent":100,"sort":101},{"id":102,"name":"Html","parent":100,"sort":102},{"id":200,"name":"Java","parent":0,"sort":200},{"id":300,"name":"MySql","parent":0,"sort":200},{"id":201,"name":"基础应用","parent":200,"sort":201},{"id":202,"name":"框架应用","parent":200,"sort":202},{"id":301,"name":"数据分析师","parent":300,"sort":301},{"id":302,"name":"数据工程师","parent":300,"sort":302},{"id":400,"name":"郭毛毛","parent":0,"sort":400},{"id":310978500236288,"name":"郭毛毛的大哥","parent":400,"sort":401},{"id":311011061306368,"name":"郭毛毛的二哥","parent":400,"sort":402}],"success":true}
2021-09-24 15:03:03.040 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :93   [32m377726288237568   [0;39m ------------- 结束 耗时：18 ms -------------
2021-09-24 15:03:03.064 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :55   [32m377726288925696   [0;39m ------------- 开始 -------------
2021-09-24 15:03:03.064 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :56   [32m377726288925696   [0;39m 请求地址: http://localhost:8888/category/all GET
2021-09-24 15:03:03.064 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :57   [32m377726288925696   [0;39m 类名方法: com.orange_yishenggong.wiki.controller.CategoryController.all
2021-09-24 15:03:03.065 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :58   [32m377726288925696   [0;39m 远程地址: 0:0:0:0:0:0:0:1
2021-09-24 15:03:03.065 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :80   [32m377726288925696   [0;39m 请求参数: []
2021-09-24 15:03:03.066 DEBUG c.o.wiki.mapper.CategoryMapper.selectByExample    :137  [32m377726288925696   [0;39m ==>  Preparing: select id, parent, `name`, sort from category order by sort asc
2021-09-24 15:03:03.066 DEBUG c.o.wiki.mapper.CategoryMapper.selectByExample    :137  [32m377726288925696   [0;39m ==> Parameters: 
2021-09-24 15:03:03.068 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377726288925696   [0;39m <==    Columns: id, parent, name, sort
2021-09-24 15:03:03.068 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377726288925696   [0;39m <==        Row: 100, 0, 前端开发, 100
2021-09-24 15:03:03.068 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377726288925696   [0;39m <==        Row: 101, 100, Vue, 101
2021-09-24 15:03:03.068 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377726288925696   [0;39m <==        Row: 102, 100, Html, 102
2021-09-24 15:03:03.069 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377726288925696   [0;39m <==        Row: 200, 0, Java, 200
2021-09-24 15:03:03.069 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377726288925696   [0;39m <==        Row: 300, 0, MySql, 200
2021-09-24 15:03:03.069 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377726288925696   [0;39m <==        Row: 201, 200, 基础应用, 201
2021-09-24 15:03:03.069 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377726288925696   [0;39m <==        Row: 202, 200, 框架应用, 202
2021-09-24 15:03:03.070 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377726288925696   [0;39m <==        Row: 301, 300, 数据分析师, 301
2021-09-24 15:03:03.070 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377726288925696   [0;39m <==        Row: 302, 300, 数据工程师, 302
2021-09-24 15:03:03.070 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377726288925696   [0;39m <==        Row: 400, 0, 郭毛毛, 400
2021-09-24 15:03:03.070 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377726288925696   [0;39m <==        Row: 310978500236288, 400, 郭毛毛的大哥, 401
2021-09-24 15:03:03.071 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377726288925696   [0;39m <==        Row: 311011061306368, 400, 郭毛毛的二哥, 402
2021-09-24 15:03:03.071 DEBUG c.o.wiki.mapper.CategoryMapper.selectByExample    :137  [32m377726288925696   [0;39m <==      Total: 12
2021-09-24 15:03:03.072 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :92   [32m377726288925696   [0;39m 返回结果: {"content":[{"id":100,"name":"前端开发","parent":0,"sort":100},{"id":101,"name":"Vue","parent":100,"sort":101},{"id":102,"name":"Html","parent":100,"sort":102},{"id":200,"name":"Java","parent":0,"sort":200},{"id":300,"name":"MySql","parent":0,"sort":200},{"id":201,"name":"基础应用","parent":200,"sort":201},{"id":202,"name":"框架应用","parent":200,"sort":202},{"id":301,"name":"数据分析师","parent":300,"sort":301},{"id":302,"name":"数据工程师","parent":300,"sort":302},{"id":400,"name":"郭毛毛","parent":0,"sort":400},{"id":310978500236288,"name":"郭毛毛的大哥","parent":400,"sort":401},{"id":311011061306368,"name":"郭毛毛的二哥","parent":400,"sort":402}],"success":true}
2021-09-24 15:03:03.072 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :93   [32m377726288925696   [0;39m ------------- 结束 耗时：8 ms -------------
2021-09-24 15:03:05.010 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377726320808960   [0;39m 生成今日电子书快照开始
2021-09-24 15:03:05.012 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377726320808960   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:03:05.014 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377726320808960   [0;39m ==> Parameters: 
2021-09-24 15:03:05.016 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377726320808960   [0;39m <==    Updates: 0
2021-09-24 15:03:05.016 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377726320808960   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:03:30.012 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377726730441728   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:03:30.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377726730441728   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:03:30.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377726730441728   [0;39m ==> Parameters: 
2021-09-24 15:03:30.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377726730441728   [0;39m <==    Updates: 4
2021-09-24 15:03:30.017 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377726730441728   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:03:35.008 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377726812296192   [0;39m 生成今日电子书快照开始
2021-09-24 15:03:35.010 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377726812296192   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:03:35.011 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377726812296192   [0;39m ==> Parameters: 
2021-09-24 15:03:35.014 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377726812296192   [0;39m <==    Updates: 0
2021-09-24 15:03:35.014 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377726812296192   [0;39m 生成今日电子书快照结束，耗时：6毫秒
2021-09-24 15:04:00.005 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377727221847040   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:04:00.006 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377727221847040   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:04:00.007 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377727221847040   [0;39m ==> Parameters: 
2021-09-24 15:04:00.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377727221847040   [0;39m <==    Updates: 4
2021-09-24 15:04:00.009 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377727221847040   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:04:05.014 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377727303914496   [0;39m 生成今日电子书快照开始
2021-09-24 15:04:05.015 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377727303914496   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:04:05.016 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377727303914496   [0;39m ==> Parameters: 
2021-09-24 15:04:05.019 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377727303914496   [0;39m <==    Updates: 0
2021-09-24 15:04:05.020 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377727303914496   [0;39m 生成今日电子书快照结束，耗时：6毫秒
2021-09-24 15:04:30.009 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377727713432576   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:04:30.011 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377727713432576   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:04:30.011 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377727713432576   [0;39m ==> Parameters: 
2021-09-24 15:04:30.013 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377727713432576   [0;39m <==    Updates: 4
2021-09-24 15:04:30.013 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377727713432576   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 15:04:35.007 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377727795319808   [0;39m 生成今日电子书快照开始
2021-09-24 15:04:35.008 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377727795319808   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:04:35.010 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377727795319808   [0;39m ==> Parameters: 
2021-09-24 15:04:35.012 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377727795319808   [0;39m <==    Updates: 0
2021-09-24 15:04:35.013 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377727795319808   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:05:00.010 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377728204968960   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:05:00.012 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377728204968960   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:05:00.013 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377728204968960   [0;39m ==> Parameters: 
2021-09-24 15:05:00.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377728204968960   [0;39m <==    Updates: 4
2021-09-24 15:05:00.015 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377728204968960   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:05:05.002 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377728286757888   [0;39m 生成今日电子书快照开始
2021-09-24 15:05:05.003 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377728286757888   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:05:05.005 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377728286757888   [0;39m ==> Parameters: 
2021-09-24 15:05:05.014 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377728286757888   [0;39m <==    Updates: 0
2021-09-24 15:05:05.015 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377728286757888   [0;39m 生成今日电子书快照结束，耗时：13毫秒
2021-09-24 15:05:30.004 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377728696390656   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:05:30.005 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377728696390656   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:05:30.006 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377728696390656   [0;39m ==> Parameters: 
2021-09-24 15:05:30.008 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377728696390656   [0;39m <==    Updates: 4
2021-09-24 15:05:30.008 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377728696390656   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:05:35.002 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377728778277888   [0;39m 生成今日电子书快照开始
2021-09-24 15:05:35.003 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377728778277888   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:05:35.003 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377728778277888   [0;39m ==> Parameters: 
2021-09-24 15:05:35.006 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377728778277888   [0;39m <==    Updates: 0
2021-09-24 15:05:35.006 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377728778277888   [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-09-24 15:06:00.012 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377729188041728   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:06:00.013 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377729188041728   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:06:00.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377729188041728   [0;39m ==> Parameters: 
2021-09-24 15:06:00.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377729188041728   [0;39m <==    Updates: 4
2021-09-24 15:06:00.016 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377729188041728   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:06:05.009 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377729269912576   [0;39m 生成今日电子书快照开始
2021-09-24 15:06:05.011 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377729269912576   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:06:05.012 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377729269912576   [0;39m ==> Parameters: 
2021-09-24 15:06:05.015 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377729269912576   [0;39m <==    Updates: 0
2021-09-24 15:06:05.015 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377729269912576   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:06:30.006 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377729679463424   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:06:30.007 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377729679463424   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:06:30.007 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377729679463424   [0;39m ==> Parameters: 
2021-09-24 15:06:30.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377729679463424   [0;39m <==    Updates: 4
2021-09-24 15:06:30.009 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377729679463424   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 15:06:35.009 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377729761432576   [0;39m 生成今日电子书快照开始
2021-09-24 15:06:35.011 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377729761432576   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:06:35.012 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377729761432576   [0;39m ==> Parameters: 
2021-09-24 15:06:35.014 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377729761432576   [0;39m <==    Updates: 0
2021-09-24 15:06:35.014 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377729761432576   [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-09-24 15:07:00.003 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377730170934272   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:07:00.005 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377730170934272   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:07:00.005 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377730170934272   [0;39m ==> Parameters: 
2021-09-24 15:07:00.007 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377730170934272   [0;39m <==    Updates: 4
2021-09-24 15:07:00.007 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377730170934272   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 15:07:05.002 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377730252837888   [0;39m 生成今日电子书快照开始
2021-09-24 15:07:05.003 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377730252837888   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:07:05.004 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377730252837888   [0;39m ==> Parameters: 
2021-09-24 15:07:05.006 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377730252837888   [0;39m <==    Updates: 0
2021-09-24 15:07:05.006 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377730252837888   [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-09-24 15:07:30.005 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377730662487040   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:07:30.007 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377730662487040   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:07:30.007 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377730662487040   [0;39m ==> Parameters: 
2021-09-24 15:07:30.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377730662487040   [0;39m <==    Updates: 4
2021-09-24 15:07:30.009 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377730662487040   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 15:07:35.008 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377730744456192   [0;39m 生成今日电子书快照开始
2021-09-24 15:07:35.010 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377730744456192   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:07:35.012 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377730744456192   [0;39m ==> Parameters: 
2021-09-24 15:07:35.016 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377730744456192   [0;39m <==    Updates: 0
2021-09-24 15:07:35.017 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377730744456192   [0;39m 生成今日电子书快照结束，耗时：8毫秒
2021-09-24 15:08:00.009 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377731154072576   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:08:00.010 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377731154072576   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:08:00.011 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377731154072576   [0;39m ==> Parameters: 
2021-09-24 15:08:00.012 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377731154072576   [0;39m <==    Updates: 4
2021-09-24 15:08:00.013 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377731154072576   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:08:05.009 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377731235992576   [0;39m 生成今日电子书快照开始
2021-09-24 15:08:05.010 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377731235992576   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:08:05.011 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377731235992576   [0;39m ==> Parameters: 
2021-09-24 15:08:05.013 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377731235992576   [0;39m <==    Updates: 0
2021-09-24 15:08:05.014 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377731235992576   [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-09-24 15:08:30.010 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377731645608960   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:08:30.011 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377731645608960   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:08:30.011 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377731645608960   [0;39m ==> Parameters: 
2021-09-24 15:08:30.013 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377731645608960   [0;39m <==    Updates: 4
2021-09-24 15:08:30.013 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377731645608960   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 15:08:35.007 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377731727479808   [0;39m 生成今日电子书快照开始
2021-09-24 15:08:35.008 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377731727479808   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:08:35.009 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377731727479808   [0;39m ==> Parameters: 
2021-09-24 15:08:35.011 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377731727479808   [0;39m <==    Updates: 0
2021-09-24 15:08:35.012 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377731727479808   [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-09-24 15:09:00.004 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377732137030656   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:09:00.006 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377732137030656   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:09:00.006 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377732137030656   [0;39m ==> Parameters: 
2021-09-24 15:09:00.008 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377732137030656   [0;39m <==    Updates: 4
2021-09-24 15:09:00.009 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377732137030656   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:09:05.011 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377732219065344   [0;39m 生成今日电子书快照开始
2021-09-24 15:09:05.013 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377732219065344   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:09:05.014 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377732219065344   [0;39m ==> Parameters: 
2021-09-24 15:09:05.016 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377732219065344   [0;39m <==    Updates: 0
2021-09-24 15:09:05.016 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377732219065344   [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-09-24 15:09:30.011 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377732628665344   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:09:30.013 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377732628665344   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:09:30.013 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377732628665344   [0;39m ==> Parameters: 
2021-09-24 15:09:30.015 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377732628665344   [0;39m <==    Updates: 4
2021-09-24 15:09:30.015 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377732628665344   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 15:09:35.016 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377732710667264   [0;39m 生成今日电子书快照开始
2021-09-24 15:09:35.017 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377732710667264   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:09:35.018 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377732710667264   [0;39m ==> Parameters: 
2021-09-24 15:09:35.020 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377732710667264   [0;39m <==    Updates: 0
2021-09-24 15:09:35.021 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377732710667264   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:10:00.014 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377733120234496   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:10:00.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377733120234496   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:10:00.017 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377733120234496   [0;39m ==> Parameters: 
2021-09-24 15:10:00.019 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377733120234496   [0;39m <==    Updates: 4
2021-09-24 15:10:00.019 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377733120234496   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:10:05.002 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377733201957888   [0;39m 生成今日电子书快照开始
2021-09-24 15:10:05.004 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377733201957888   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:10:05.004 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377733201957888   [0;39m ==> Parameters: 
2021-09-24 15:10:05.007 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377733201957888   [0;39m <==    Updates: 0
2021-09-24 15:10:05.007 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377733201957888   [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-09-24 15:10:30.007 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377733611639808   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:10:30.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377733611639808   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:10:30.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377733611639808   [0;39m ==> Parameters: 
2021-09-24 15:10:30.012 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377733611639808   [0;39m <==    Updates: 4
2021-09-24 15:10:30.012 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377733611639808   [0;39m 更新电子书下的文档数据结束，耗时：5毫秒
2021-09-24 15:10:35.004 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377733693510656   [0;39m 生成今日电子书快照开始
2021-09-24 15:10:35.005 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377733693510656   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:10:35.007 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377733693510656   [0;39m ==> Parameters: 
2021-09-24 15:10:35.010 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377733693510656   [0;39m <==    Updates: 0
2021-09-24 15:10:35.010 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377733693510656   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:11:00.013 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377734103258112   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:11:00.015 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377734103258112   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:11:00.015 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377734103258112   [0;39m ==> Parameters: 
2021-09-24 15:11:00.017 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377734103258112   [0;39m <==    Updates: 4
2021-09-24 15:11:00.018 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377734103258112   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:11:05.012 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377734185161728   [0;39m 生成今日电子书快照开始
2021-09-24 15:11:05.013 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377734185161728   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:11:05.014 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377734185161728   [0;39m ==> Parameters: 
2021-09-24 15:11:05.017 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377734185161728   [0;39m <==    Updates: 0
2021-09-24 15:11:05.017 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377734185161728   [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-09-24 15:11:25.213 INFO  c.o.wiki.websocket.WebSocketServer                :41   [32m                  [0;39m 连接关闭，token：c3T2YgWBbj，session id：0！当前连接数：0
2021-09-24 15:11:26.029 INFO  c.o.wiki.websocket.WebSocketServer                :32   [32m                  [0;39m 有新连接：token：rJxlnmdcup，session id：1，当前连接数：1
2021-09-24 15:11:30.011 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377734594745344   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:11:30.012 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377734594745344   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:11:30.013 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377734594745344   [0;39m ==> Parameters: 
2021-09-24 15:11:30.015 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377734594745344   [0;39m <==    Updates: 4
2021-09-24 15:11:30.015 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377734594745344   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:11:35.002 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377734676517888   [0;39m 生成今日电子书快照开始
2021-09-24 15:11:35.003 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377734676517888   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:11:35.004 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377734676517888   [0;39m ==> Parameters: 
2021-09-24 15:11:35.006 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377734676517888   [0;39m <==    Updates: 0
2021-09-24 15:11:35.007 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377734676517888   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:12:00.012 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377735086281728   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:12:00.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377735086281728   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:12:00.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377735086281728   [0;39m ==> Parameters: 
2021-09-24 15:12:00.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377735086281728   [0;39m <==    Updates: 4
2021-09-24 15:12:00.017 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377735086281728   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:12:05.008 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377735168136192   [0;39m 生成今日电子书快照开始
2021-09-24 15:12:05.010 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377735168136192   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:12:05.011 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377735168136192   [0;39m ==> Parameters: 
2021-09-24 15:12:05.013 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377735168136192   [0;39m <==    Updates: 0
2021-09-24 15:12:05.014 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377735168136192   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:12:30.014 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377735577834496   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:12:30.015 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377735577834496   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:12:30.015 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377735577834496   [0;39m ==> Parameters: 
2021-09-24 15:12:30.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377735577834496   [0;39m <==    Updates: 4
2021-09-24 15:12:30.017 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377735577834496   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 15:12:35.011 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377735659705344   [0;39m 生成今日电子书快照开始
2021-09-24 15:12:35.012 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377735659705344   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:12:35.013 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377735659705344   [0;39m ==> Parameters: 
2021-09-24 15:12:35.015 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377735659705344   [0;39m <==    Updates: 0
2021-09-24 15:12:35.016 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377735659705344   [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-09-24 15:13:00.007 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377736069239808   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:13:00.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377736069239808   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:13:00.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377736069239808   [0;39m ==> Parameters: 
2021-09-24 15:13:00.011 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377736069239808   [0;39m <==    Updates: 4
2021-09-24 15:13:00.011 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377736069239808   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 15:13:05.013 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377736151258112   [0;39m 生成今日电子书快照开始
2021-09-24 15:13:05.014 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377736151258112   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:13:05.015 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377736151258112   [0;39m ==> Parameters: 
2021-09-24 15:13:05.017 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377736151258112   [0;39m <==    Updates: 0
2021-09-24 15:13:05.017 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377736151258112   [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-09-24 15:13:30.009 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377736560792576   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:13:30.011 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377736560792576   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:13:30.011 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377736560792576   [0;39m ==> Parameters: 
2021-09-24 15:13:30.013 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377736560792576   [0;39m <==    Updates: 4
2021-09-24 15:13:30.013 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377736560792576   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 15:13:35.007 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377736642679808   [0;39m 生成今日电子书快照开始
2021-09-24 15:13:35.008 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377736642679808   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:13:35.009 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377736642679808   [0;39m ==> Parameters: 
2021-09-24 15:13:35.011 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377736642679808   [0;39m <==    Updates: 0
2021-09-24 15:13:35.012 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377736642679808   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:14:00.014 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377737052394496   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:14:00.015 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377737052394496   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:14:00.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377737052394496   [0;39m ==> Parameters: 
2021-09-24 15:14:00.018 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377737052394496   [0;39m <==    Updates: 4
2021-09-24 15:14:00.018 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377737052394496   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 15:14:05.004 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377737134150656   [0;39m 生成今日电子书快照开始
2021-09-24 15:14:05.005 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377737134150656   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:14:05.006 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377737134150656   [0;39m ==> Parameters: 
2021-09-24 15:14:05.008 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377737134150656   [0;39m <==    Updates: 0
2021-09-24 15:14:05.009 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377737134150656   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:14:30.013 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377737543898112   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:14:30.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377737543898112   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:14:30.015 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377737543898112   [0;39m ==> Parameters: 
2021-09-24 15:14:30.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377737543898112   [0;39m <==    Updates: 4
2021-09-24 15:14:30.016 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377737543898112   [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-09-24 15:14:35.015 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377737625850880   [0;39m 生成今日电子书快照开始
2021-09-24 15:14:35.017 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377737625850880   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:14:35.018 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377737625850880   [0;39m ==> Parameters: 
2021-09-24 15:14:35.020 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377737625850880   [0;39m <==    Updates: 0
2021-09-24 15:14:35.021 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377737625850880   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:14:54.803 INFO  c.o.wiki.websocket.WebSocketServer                :41   [32m                  [0;39m 连接关闭，token：rJxlnmdcup，session id：1！当前连接数：0
2021-09-24 15:14:55.638 INFO  c.o.wiki.websocket.WebSocketServer                :32   [32m                  [0;39m 有新连接：token：740yns5JE4，session id：2，当前连接数：1
2021-09-24 15:15:00.014 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377738035434496   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:15:00.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377738035434496   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:15:00.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377738035434496   [0;39m ==> Parameters: 
2021-09-24 15:15:00.019 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377738035434496   [0;39m <==    Updates: 4
2021-09-24 15:15:00.019 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377738035434496   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:15:06.170 INFO  org.hibernate.validator.internal.util.Version     :21   [32m                  [0;39m HV000001: Hibernate Validator 6.2.0.Final
2021-09-24 15:15:06.186 INFO  com.orange_yishenggong.wiki.config.WikiApplication:55   [32m                  [0;39m Starting WikiApplication using Java 16.0.1 on LAPTOP-GE9IV29P with PID 10488 (C:\Users\Orange Meow\IdeaProjects\wiki\target\classes started by Orange Meow in C:\Users\Orange Meow\IdeaProjects\wiki)
2021-09-24 15:15:06.187 INFO  com.orange_yishenggong.wiki.config.WikiApplication:663  [32m                  [0;39m No active profile set, falling back to default profiles: default
2021-09-24 15:15:07.018 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :262  [32m                  [0;39m Multiple Spring Data modules found, entering strict repository configuration mode!
2021-09-24 15:15:07.021 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :132  [32m                  [0;39m Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2021-09-24 15:15:07.047 INFO  o.s.d.r.config.RepositoryConfigurationDelegate    :201  [32m                  [0;39m Finished Spring Data repository scanning in 10 ms. Found 0 Redis repository interfaces.
2021-09-24 15:15:07.839 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :108  [32m                  [0;39m Tomcat initialized with port(s): 8888 (http)
2021-09-24 15:15:07.853 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Initializing ProtocolHandler ["http-nio-8888"]
2021-09-24 15:15:07.854 INFO  org.apache.catalina.core.StandardService          :173  [32m                  [0;39m Starting service [Tomcat]
2021-09-24 15:15:07.855 INFO  org.apache.catalina.core.StandardEngine           :173  [32m                  [0;39m Starting Servlet engine: [Apache Tomcat/9.0.46]
2021-09-24 15:15:07.989 INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] :173  [32m                  [0;39m Initializing Spring embedded WebApplicationContext
2021-09-24 15:15:07.989 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext    :290  [32m                  [0;39m Root WebApplicationContext: initialization completed in 1741 ms
2021-09-24 15:15:09.618 INFO  org.apache.coyote.http11.Http11NioProtocol        :173  [32m                  [0;39m Starting ProtocolHandler ["http-nio-8888"]
2021-09-24 15:15:09.670 INFO  o.s.boot.web.embedded.tomcat.TomcatWebServer      :220  [32m                  [0;39m Tomcat started on port(s): 8888 (http) with context path ''
2021-09-24 15:15:09.692 INFO  com.orange_yishenggong.wiki.config.WikiApplication:61   [32m                  [0;39m Started WikiApplication in 4.086 seconds (JVM running for 4.956)
2021-09-24 15:15:09.695 INFO  o.s.boot.availability.ApplicationAvailabilityBean :75   [32m                  [0;39m Application availability state LivenessState changed to CORRECT
2021-09-24 15:15:09.698 INFO  o.s.boot.availability.ApplicationAvailabilityBean :75   [32m                  [0;39m Application availability state ReadinessState changed to ACCEPTING_TRAFFIC
2021-09-24 15:15:09.698 INFO  com.orange_yishenggong.wiki.config.WikiApplication:23   [32m                  [0;39m 启动成功	:)
2021-09-24 15:15:09.698 INFO  com.orange_yishenggong.wiki.config.WikiApplication:24   [32m                  [0;39m 地址:	http://127.0.0.1:8888
2021-09-24 15:15:15.768 INFO  o.a.c.core.ContainerBase.[Tomcat].[localhost].[/] :173  [32m                  [0;39m Initializing Spring DispatcherServlet 'dispatcherServlet'
2021-09-24 15:15:15.769 INFO  org.springframework.web.servlet.DispatcherServlet :525  [32m                  [0;39m Initializing Servlet 'dispatcherServlet'
2021-09-24 15:15:15.771 INFO  org.springframework.web.servlet.DispatcherServlet :547  [32m                  [0;39m Completed initialization in 2 ms
2021-09-24 15:15:15.835 INFO  c.o.wiki.websocket.WebSocketServer                :32   [32m                  [0;39m 有新连接：token：kFGnbqh7Yi，session id：0，当前连接数：1
2021-09-24 15:15:19.173 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :55   [32m377738349302784   [0;39m ------------- 开始 -------------
2021-09-24 15:15:19.174 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :56   [32m377738349302784   [0;39m 请求地址: http://localhost:8888/user/login POST
2021-09-24 15:15:19.175 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :57   [32m377738349302784   [0;39m 类名方法: com.orange_yishenggong.wiki.controller.UserController.login
2021-09-24 15:15:19.175 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :58   [32m377738349302784   [0;39m 远程地址: 0:0:0:0:0:0:0:1
2021-09-24 15:15:19.240 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :80   [32m377738349302784   [0;39m 请求参数: [{"loginName":"test1"}]
2021-09-24 15:15:19.291 INFO  com.zaxxer.hikari.HikariDataSource                :110  [32m377738349302784   [0;39m HikariPool-1 - Starting...
2021-09-24 15:15:19.628 INFO  com.zaxxer.hikari.HikariDataSource                :123  [32m377738349302784   [0;39m HikariPool-1 - Start completed.
2021-09-24 15:15:19.636 DEBUG c.o.wiki.mapper.UserMapper.selectByExample        :137  [32m377738349302784   [0;39m ==>  Preparing: select id, login_name, nickname, `password` from user WHERE ( login_name = ? )
2021-09-24 15:15:19.657 DEBUG c.o.wiki.mapper.UserMapper.selectByExample        :137  [32m377738349302784   [0;39m ==> Parameters: test1(String)
2021-09-24 15:15:19.680 TRACE c.o.wiki.mapper.UserMapper.selectByExample        :143  [32m377738349302784   [0;39m <==    Columns: id, login_name, nickname, password
2021-09-24 15:15:19.681 TRACE c.o.wiki.mapper.UserMapper.selectByExample        :143  [32m377738349302784   [0;39m <==        Row: 319043990279168, test1, ceshi1, 7354a1d413535a6c0dc5c209e198d799
2021-09-24 15:15:19.682 DEBUG c.o.wiki.mapper.UserMapper.selectByExample        :137  [32m377738349302784   [0;39m <==      Total: 1
2021-09-24 15:15:19.695 INFO  c.o.wiki.controller.UserController                :77   [32m377738349302784   [0;39m 生成单点登录token:377738357888000,并放入redis
2021-09-24 15:15:25.125 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :92   [32m377738349302784   [0;39m 返回结果: {"content":{"id":319043990279168,"loginName":"test1","nickname":"ceshi1","token":"377738357888000"},"success":true}
2021-09-24 15:15:25.126 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :93   [32m377738349302784   [0;39m ------------- 结束 耗时：5955 ms -------------
2021-09-24 15:15:30.012 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377738526921728   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:15:30.018 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377738526921728   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:15:30.019 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377738526921728   [0;39m ==> Parameters: 
2021-09-24 15:15:30.058 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377738526921728   [0;39m <==    Updates: 4
2021-09-24 15:15:30.059 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377738526921728   [0;39m 更新电子书下的文档数据结束，耗时：46毫秒
2021-09-24 15:15:35.008 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377738608776192   [0;39m 生成今日电子书快照开始
2021-09-24 15:15:35.008 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377738608776192   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:15:35.013 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377738608776192   [0;39m ==> Parameters: 
2021-09-24 15:15:35.016 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377738608776192   [0;39m <==    Updates: 0
2021-09-24 15:15:35.016 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377738608776192   [0;39m 生成今日电子书快照结束，耗时：8毫秒
2021-09-24 15:16:00.011 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377739018425344   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:16:00.013 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377739018425344   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:16:00.015 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377739018425344   [0;39m ==> Parameters: 
2021-09-24 15:16:00.017 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377739018425344   [0;39m <==    Updates: 4
2021-09-24 15:16:00.017 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377739018425344   [0;39m 更新电子书下的文档数据结束，耗时：5毫秒
2021-09-24 15:16:05.004 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377739100230656   [0;39m 生成今日电子书快照开始
2021-09-24 15:16:05.006 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377739100230656   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:16:05.007 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377739100230656   [0;39m ==> Parameters: 
2021-09-24 15:16:05.010 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377739100230656   [0;39m <==    Updates: 0
2021-09-24 15:16:05.010 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377739100230656   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:16:30.041 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377739510420480   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:16:30.053 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377739510420480   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:16:30.056 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377739510420480   [0;39m ==> Parameters: 
2021-09-24 15:16:30.070 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377739510420480   [0;39m <==    Updates: 4
2021-09-24 15:16:30.131 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377739510420480   [0;39m 更新电子书下的文档数据结束，耗时：89毫秒
2021-09-24 15:16:35.005 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377739591767040   [0;39m 生成今日电子书快照开始
2021-09-24 15:16:35.007 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377739591767040   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:16:35.008 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377739591767040   [0;39m ==> Parameters: 
2021-09-24 15:16:35.010 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377739591767040   [0;39m <==    Updates: 0
2021-09-24 15:16:35.011 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377739591767040   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:17:00.000 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377740001285120   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:17:00.004 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377740001285120   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:17:00.005 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377740001285120   [0;39m ==> Parameters: 
2021-09-24 15:17:00.007 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377740001285120   [0;39m <==    Updates: 4
2021-09-24 15:17:00.008 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377740001285120   [0;39m 更新电子书下的文档数据结束，耗时：5毫秒
2021-09-24 15:17:05.000 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377740083205120   [0;39m 生成今日电子书快照开始
2021-09-24 15:17:05.002 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377740083205120   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:17:05.003 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377740083205120   [0;39m ==> Parameters: 
2021-09-24 15:17:05.064 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377740083205120   [0;39m <==    Updates: 0
2021-09-24 15:17:05.065 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377740083205120   [0;39m 生成今日电子书快照结束，耗时：64毫秒
2021-09-24 15:17:30.004 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377740492870656   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:17:30.006 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377740492870656   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:17:30.006 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377740492870656   [0;39m ==> Parameters: 
2021-09-24 15:17:30.008 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377740492870656   [0;39m <==    Updates: 4
2021-09-24 15:17:30.009 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377740492870656   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:17:35.009 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377740574872576   [0;39m 生成今日电子书快照开始
2021-09-24 15:17:35.011 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377740574872576   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:17:35.013 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377740574872576   [0;39m ==> Parameters: 
2021-09-24 15:17:35.016 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377740574872576   [0;39m <==    Updates: 0
2021-09-24 15:17:35.016 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377740574872576   [0;39m 生成今日电子书快照结束，耗时：6毫秒
2021-09-24 15:18:00.009 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377740984472576   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:18:00.011 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377740984472576   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:18:00.012 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377740984472576   [0;39m ==> Parameters: 
2021-09-24 15:18:00.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377740984472576   [0;39m <==    Updates: 4
2021-09-24 15:18:00.015 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377740984472576   [0;39m 更新电子书下的文档数据结束，耗时：5毫秒
2021-09-24 15:18:05.002 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377741066277888   [0;39m 生成今日电子书快照开始
2021-09-24 15:18:05.004 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377741066277888   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:18:05.005 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377741066277888   [0;39m ==> Parameters: 
2021-09-24 15:18:05.008 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377741066277888   [0;39m <==    Updates: 0
2021-09-24 15:18:05.008 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377741066277888   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:18:30.006 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377741475943424   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:18:30.008 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377741475943424   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:18:30.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377741475943424   [0;39m ==> Parameters: 
2021-09-24 15:18:30.011 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377741475943424   [0;39m <==    Updates: 4
2021-09-24 15:18:30.011 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377741475943424   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:18:35.001 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377741557781504   [0;39m 生成今日电子书快照开始
2021-09-24 15:18:35.054 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377741557781504   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:18:35.055 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377741557781504   [0;39m ==> Parameters: 
2021-09-24 15:18:35.058 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377741557781504   [0;39m <==    Updates: 0
2021-09-24 15:18:35.058 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377741557781504   [0;39m 生成今日电子书快照结束，耗时：54毫秒
2021-09-24 15:19:00.008 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377741967496192   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:19:00.011 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377741967496192   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:19:00.012 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377741967496192   [0;39m ==> Parameters: 
2021-09-24 15:19:00.015 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377741967496192   [0;39m <==    Updates: 4
2021-09-24 15:19:00.017 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377741967496192   [0;39m 更新电子书下的文档数据结束，耗时：8毫秒
2021-09-24 15:19:05.005 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377742049367040   [0;39m 生成今日电子书快照开始
2021-09-24 15:19:05.008 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377742049367040   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:19:05.009 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377742049367040   [0;39m ==> Parameters: 
2021-09-24 15:19:05.012 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377742049367040   [0;39m <==    Updates: 0
2021-09-24 15:19:05.013 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377742049367040   [0;39m 生成今日电子书快照结束，耗时：7毫秒
2021-09-24 15:19:30.008 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377742459016192   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:19:30.011 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377742459016192   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:19:30.012 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377742459016192   [0;39m ==> Parameters: 
2021-09-24 15:19:30.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377742459016192   [0;39m <==    Updates: 4
2021-09-24 15:19:30.014 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377742459016192   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:19:35.004 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377742540870656   [0;39m 生成今日电子书快照开始
2021-09-24 15:19:35.006 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377742540870656   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:19:35.007 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377742540870656   [0;39m ==> Parameters: 
2021-09-24 15:19:35.009 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377742540870656   [0;39m <==    Updates: 0
2021-09-24 15:19:35.010 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377742540870656   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:20:00.010 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377742950568960   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:20:00.012 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377742950568960   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:20:00.013 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377742950568960   [0;39m ==> Parameters: 
2021-09-24 15:20:00.015 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377742950568960   [0;39m <==    Updates: 4
2021-09-24 15:20:00.016 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377742950568960   [0;39m 更新电子书下的文档数据结束，耗时：5毫秒
2021-09-24 15:20:05.002 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377743032357888   [0;39m 生成今日电子书快照开始
2021-09-24 15:20:05.004 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377743032357888   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:20:05.005 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377743032357888   [0;39m ==> Parameters: 
2021-09-24 15:20:05.008 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377743032357888   [0;39m <==    Updates: 0
2021-09-24 15:20:05.008 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377743032357888   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:20:30.013 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377743442138112   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:20:30.015 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377743442138112   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:20:30.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377743442138112   [0;39m ==> Parameters: 
2021-09-24 15:20:30.018 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377743442138112   [0;39m <==    Updates: 4
2021-09-24 15:20:30.018 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377743442138112   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:20:35.013 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377743524058112   [0;39m 生成今日电子书快照开始
2021-09-24 15:20:35.015 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377743524058112   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:20:35.016 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377743524058112   [0;39m ==> Parameters: 
2021-09-24 15:20:35.019 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377743524058112   [0;39m <==    Updates: 0
2021-09-24 15:20:35.019 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377743524058112   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:21:00.005 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377743933527040   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:21:00.007 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377743933527040   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:21:00.008 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377743933527040   [0;39m ==> Parameters: 
2021-09-24 15:21:00.010 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377743933527040   [0;39m <==    Updates: 4
2021-09-24 15:21:00.011 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377743933527040   [0;39m 更新电子书下的文档数据结束，耗时：5毫秒
2021-09-24 15:21:05.006 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377744015463424   [0;39m 生成今日电子书快照开始
2021-09-24 15:21:05.008 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377744015463424   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:21:05.008 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377744015463424   [0;39m ==> Parameters: 
2021-09-24 15:21:05.011 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377744015463424   [0;39m <==    Updates: 0
2021-09-24 15:21:05.012 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377744015463424   [0;39m 生成今日电子书快照结束，耗时：6毫秒
2021-09-24 15:21:30.007 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377744425079808   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:21:30.008 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377744425079808   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:21:30.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377744425079808   [0;39m ==> Parameters: 
2021-09-24 15:21:30.011 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377744425079808   [0;39m <==    Updates: 4
2021-09-24 15:21:30.011 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377744425079808   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:21:35.001 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377744506901504   [0;39m 生成今日电子书快照开始
2021-09-24 15:21:35.003 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377744506901504   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:21:35.004 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377744506901504   [0;39m ==> Parameters: 
2021-09-24 15:21:35.007 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377744506901504   [0;39m <==    Updates: 0
2021-09-24 15:21:35.007 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377744506901504   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:22:00.012 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377744916681728   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:22:00.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377744916681728   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:22:00.015 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377744916681728   [0;39m ==> Parameters: 
2021-09-24 15:22:00.017 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377744916681728   [0;39m <==    Updates: 4
2021-09-24 15:22:00.018 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377744916681728   [0;39m 更新电子书下的文档数据结束，耗时：5毫秒
2021-09-24 15:22:05.002 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377744998437888   [0;39m 生成今日电子书快照开始
2021-09-24 15:22:05.003 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377744998437888   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:22:05.003 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377744998437888   [0;39m ==> Parameters: 
2021-09-24 15:22:05.006 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377744998437888   [0;39m <==    Updates: 0
2021-09-24 15:22:05.007 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377744998437888   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:22:30.013 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377745408218112   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:22:30.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377745408218112   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:22:30.015 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377745408218112   [0;39m ==> Parameters: 
2021-09-24 15:22:30.017 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377745408218112   [0;39m <==    Updates: 4
2021-09-24 15:22:30.017 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377745408218112   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:22:35.002 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377745489957888   [0;39m 生成今日电子书快照开始
2021-09-24 15:22:35.003 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377745489957888   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:22:35.005 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377745489957888   [0;39m ==> Parameters: 
2021-09-24 15:22:35.007 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377745489957888   [0;39m <==    Updates: 0
2021-09-24 15:22:35.007 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377745489957888   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:23:00.010 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377745899688960   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:23:00.011 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377745899688960   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:23:00.012 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377745899688960   [0;39m ==> Parameters: 
2021-09-24 15:23:00.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377745899688960   [0;39m <==    Updates: 4
2021-09-24 15:23:00.015 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377745899688960   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:23:05.004 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377745981510656   [0;39m 生成今日电子书快照开始
2021-09-24 15:23:05.006 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377745981510656   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:23:05.008 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377745981510656   [0;39m ==> Parameters: 
2021-09-24 15:23:05.011 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377745981510656   [0;39m <==    Updates: 0
2021-09-24 15:23:05.011 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377745981510656   [0;39m 生成今日电子书快照结束，耗时：6毫秒
2021-09-24 15:23:30.013 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377746391258112   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:23:30.015 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377746391258112   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:23:30.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377746391258112   [0;39m ==> Parameters: 
2021-09-24 15:23:30.018 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377746391258112   [0;39m <==    Updates: 4
2021-09-24 15:23:30.018 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377746391258112   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:23:35.006 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377746473063424   [0;39m 生成今日电子书快照开始
2021-09-24 15:23:35.009 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377746473063424   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:23:35.010 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377746473063424   [0;39m ==> Parameters: 
2021-09-24 15:23:35.013 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377746473063424   [0;39m <==    Updates: 0
2021-09-24 15:23:35.013 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377746473063424   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:24:00.012 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377746882761728   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:24:00.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377746882761728   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:24:00.015 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377746882761728   [0;39m ==> Parameters: 
2021-09-24 15:24:00.017 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377746882761728   [0;39m <==    Updates: 4
2021-09-24 15:24:00.018 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377746882761728   [0;39m 更新电子书下的文档数据结束，耗时：5毫秒
2021-09-24 15:24:05.010 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377746964648960   [0;39m 生成今日电子书快照开始
2021-09-24 15:24:05.011 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377746964648960   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:24:05.012 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377746964648960   [0;39m ==> Parameters: 
2021-09-24 15:24:05.015 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377746964648960   [0;39m <==    Updates: 0
2021-09-24 15:24:05.015 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377746964648960   [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-09-24 15:24:30.009 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377747374232576   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:24:30.011 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377747374232576   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:24:30.011 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377747374232576   [0;39m ==> Parameters: 
2021-09-24 15:24:30.012 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377747374232576   [0;39m <==    Updates: 4
2021-09-24 15:24:30.013 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377747374232576   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 15:24:35.013 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377747456218112   [0;39m 生成今日电子书快照开始
2021-09-24 15:24:35.015 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377747456218112   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:24:35.016 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377747456218112   [0;39m ==> Parameters: 
2021-09-24 15:24:35.019 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377747456218112   [0;39m <==    Updates: 0
2021-09-24 15:24:35.019 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377747456218112   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:25:00.007 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377747865719808   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:25:00.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377747865719808   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:25:00.010 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377747865719808   [0;39m ==> Parameters: 
2021-09-24 15:25:00.012 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377747865719808   [0;39m <==    Updates: 4
2021-09-24 15:25:00.012 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377747865719808   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:25:05.014 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377747947754496   [0;39m 生成今日电子书快照开始
2021-09-24 15:25:05.016 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377747947754496   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:25:05.017 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377747947754496   [0;39m ==> Parameters: 
2021-09-24 15:25:05.020 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377747947754496   [0;39m <==    Updates: 0
2021-09-24 15:25:05.020 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377747947754496   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:25:30.003 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377748357174272   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:25:30.005 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377748357174272   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:25:30.006 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377748357174272   [0;39m ==> Parameters: 
2021-09-24 15:25:30.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377748357174272   [0;39m <==    Updates: 4
2021-09-24 15:25:30.009 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377748357174272   [0;39m 更新电子书下的文档数据结束，耗时：5毫秒
2021-09-24 15:25:35.010 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377748439208960   [0;39m 生成今日电子书快照开始
2021-09-24 15:25:35.012 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377748439208960   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:25:35.012 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377748439208960   [0;39m ==> Parameters: 
2021-09-24 15:25:35.015 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377748439208960   [0;39m <==    Updates: 0
2021-09-24 15:25:35.015 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377748439208960   [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-09-24 15:26:00.014 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377748848858112   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:26:00.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377748848858112   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:26:00.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377748848858112   [0;39m ==> Parameters: 
2021-09-24 15:26:00.018 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377748848858112   [0;39m <==    Updates: 4
2021-09-24 15:26:00.019 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377748848858112   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:26:05.028 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377748931023872   [0;39m 生成今日电子书快照开始
2021-09-24 15:26:05.029 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377748931023872   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:26:05.031 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377748931023872   [0;39m ==> Parameters: 
2021-09-24 15:26:05.034 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377748931023872   [0;39m <==    Updates: 0
2021-09-24 15:26:05.035 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377748931023872   [0;39m 生成今日电子书快照结束，耗时：7毫秒
2021-09-24 15:26:30.000 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377749340165120   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:26:30.002 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377749340165120   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:26:30.002 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377749340165120   [0;39m ==> Parameters: 
2021-09-24 15:26:30.004 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377749340165120   [0;39m <==    Updates: 4
2021-09-24 15:26:30.004 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377749340165120   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:26:35.006 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377749422183424   [0;39m 生成今日电子书快照开始
2021-09-24 15:26:35.008 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377749422183424   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:26:35.008 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377749422183424   [0;39m ==> Parameters: 
2021-09-24 15:26:35.011 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377749422183424   [0;39m <==    Updates: 0
2021-09-24 15:26:35.011 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377749422183424   [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-09-24 15:27:00.002 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377749831717888   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:27:00.004 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377749831717888   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:27:00.005 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377749831717888   [0;39m ==> Parameters: 
2021-09-24 15:27:00.007 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377749831717888   [0;39m <==    Updates: 4
2021-09-24 15:27:00.007 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377749831717888   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:27:05.004 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377749913670656   [0;39m 生成今日电子书快照开始
2021-09-24 15:27:05.005 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377749913670656   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:27:05.007 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377749913670656   [0;39m ==> Parameters: 
2021-09-24 15:27:05.010 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377749913670656   [0;39m <==    Updates: 0
2021-09-24 15:27:05.010 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377749913670656   [0;39m 生成今日电子书快照结束，耗时：6毫秒
2021-09-24 15:27:30.015 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377750323450880   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:27:30.017 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377750323450880   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:27:30.017 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377750323450880   [0;39m ==> Parameters: 
2021-09-24 15:27:30.019 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377750323450880   [0;39m <==    Updates: 4
2021-09-24 15:27:30.019 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377750323450880   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 15:27:35.013 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377750405338112   [0;39m 生成今日电子书快照开始
2021-09-24 15:27:35.016 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377750405338112   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:27:35.017 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377750405338112   [0;39m ==> Parameters: 
2021-09-24 15:27:35.019 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377750405338112   [0;39m <==    Updates: 0
2021-09-24 15:27:35.020 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377750405338112   [0;39m 生成今日电子书快照结束，耗时：6毫秒
2021-09-24 15:28:00.009 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377750814872576   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:28:00.011 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377750814872576   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:28:00.012 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377750814872576   [0;39m ==> Parameters: 
2021-09-24 15:28:00.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377750814872576   [0;39m <==    Updates: 4
2021-09-24 15:28:00.014 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377750814872576   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:28:05.006 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377750896743424   [0;39m 生成今日电子书快照开始
2021-09-24 15:28:05.011 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377750896743424   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:28:05.013 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377750896743424   [0;39m ==> Parameters: 
2021-09-24 15:28:05.016 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377750896743424   [0;39m <==    Updates: 0
2021-09-24 15:28:05.016 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377750896743424   [0;39m 生成今日电子书快照结束，耗时：6毫秒
2021-09-24 15:28:30.015 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377751306490880   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:28:30.017 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377751306490880   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:28:30.017 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377751306490880   [0;39m ==> Parameters: 
2021-09-24 15:28:30.019 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377751306490880   [0;39m <==    Updates: 4
2021-09-24 15:28:30.019 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377751306490880   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 15:28:35.009 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377751388312576   [0;39m 生成今日电子书快照开始
2021-09-24 15:28:35.011 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377751388312576   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:28:35.012 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377751388312576   [0;39m ==> Parameters: 
2021-09-24 15:28:35.015 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377751388312576   [0;39m <==    Updates: 0
2021-09-24 15:28:35.015 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377751388312576   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:29:00.010 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377751797928960   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:29:00.012 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377751797928960   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:29:00.013 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377751797928960   [0;39m ==> Parameters: 
2021-09-24 15:29:00.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377751797928960   [0;39m <==    Updates: 4
2021-09-24 15:29:00.015 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377751797928960   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:29:05.014 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377751879914496   [0;39m 生成今日电子书快照开始
2021-09-24 15:29:05.016 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377751879914496   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:29:05.018 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377751879914496   [0;39m ==> Parameters: 
2021-09-24 15:29:05.020 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377751879914496   [0;39m <==    Updates: 0
2021-09-24 15:29:05.021 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377751879914496   [0;39m 生成今日电子书快照结束，耗时：6毫秒
2021-09-24 15:29:30.015 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377752289530880   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:29:30.017 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377752289530880   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:29:30.018 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377752289530880   [0;39m ==> Parameters: 
2021-09-24 15:29:30.019 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377752289530880   [0;39m <==    Updates: 4
2021-09-24 15:29:30.020 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377752289530880   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:29:35.013 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377752371418112   [0;39m 生成今日电子书快照开始
2021-09-24 15:29:35.015 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377752371418112   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:29:35.016 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377752371418112   [0;39m ==> Parameters: 
2021-09-24 15:29:35.019 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377752371418112   [0;39m <==    Updates: 0
2021-09-24 15:29:35.019 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377752371418112   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:30:00.005 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377752780887040   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:30:00.007 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377752780887040   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:30:00.008 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377752780887040   [0;39m ==> Parameters: 
2021-09-24 15:30:00.010 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377752780887040   [0;39m <==    Updates: 4
2021-09-24 15:30:00.010 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377752780887040   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:30:01.056 INFO  c.o.wiki.websocket.WebSocketServer                :41   [32m                  [0;39m 连接关闭，token：kFGnbqh7Yi，session id：0！当前连接数：0
2021-09-24 15:30:02.167 INFO  c.o.wiki.websocket.WebSocketServer                :32   [32m                  [0;39m 有新连接：token：QTV67nK7Qb，session id：1，当前连接数：1
2021-09-24 15:30:05.017 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377752863003648   [0;39m 生成今日电子书快照开始
2021-09-24 15:30:05.018 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377752863003648   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:30:05.020 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377752863003648   [0;39m ==> Parameters: 
2021-09-24 15:30:05.022 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377752863003648   [0;39m <==    Updates: 0
2021-09-24 15:30:05.023 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377752863003648   [0;39m 生成今日电子书快照结束，耗时：6毫秒
2021-09-24 15:30:30.007 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377753272439808   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:30:30.008 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377753272439808   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:30:30.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377753272439808   [0;39m ==> Parameters: 
2021-09-24 15:30:30.010 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377753272439808   [0;39m <==    Updates: 4
2021-09-24 15:30:30.011 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377753272439808   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:30:35.000 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377753354245120   [0;39m 生成今日电子书快照开始
2021-09-24 15:30:35.001 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377753354245120   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:30:35.002 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377753354245120   [0;39m ==> Parameters: 
2021-09-24 15:30:35.004 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377753354245120   [0;39m <==    Updates: 0
2021-09-24 15:30:35.005 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377753354245120   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:31:00.006 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377753763943424   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:31:00.008 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377753763943424   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:31:00.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377753763943424   [0;39m ==> Parameters: 
2021-09-24 15:31:00.010 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377753763943424   [0;39m <==    Updates: 4
2021-09-24 15:31:00.011 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377753763943424   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:31:05.012 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377753845961728   [0;39m 生成今日电子书快照开始
2021-09-24 15:31:05.014 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377753845961728   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:31:05.016 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377753845961728   [0;39m ==> Parameters: 
2021-09-24 15:31:05.019 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377753845961728   [0;39m <==    Updates: 0
2021-09-24 15:31:05.019 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377753845961728   [0;39m 生成今日电子书快照结束，耗时：6毫秒
2021-09-24 15:31:23.095 INFO  c.o.wiki.websocket.WebSocketServer                :41   [32m                  [0;39m 连接关闭，token：QTV67nK7Qb，session id：1！当前连接数：0
2021-09-24 15:31:23.923 INFO  c.o.wiki.websocket.WebSocketServer                :32   [32m                  [0;39m 有新连接：token：8S2WWfV5kM，session id：2，当前连接数：1
2021-09-24 15:31:24.045 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :55   [32m377754157798400   [0;39m ------------- 开始 -------------
2021-09-24 15:31:24.045 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :56   [32m377754157798400   [0;39m 请求地址: http://localhost:8888/category/all GET
2021-09-24 15:31:24.046 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :57   [32m377754157798400   [0;39m 类名方法: com.orange_yishenggong.wiki.controller.CategoryController.all
2021-09-24 15:31:24.046 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :58   [32m377754157798400   [0;39m 远程地址: 0:0:0:0:0:0:0:1
2021-09-24 15:31:24.046 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :80   [32m377754157798400   [0;39m 请求参数: []
2021-09-24 15:31:24.054 DEBUG c.o.wiki.mapper.CategoryMapper.selectByExample    :137  [32m377754157798400   [0;39m ==>  Preparing: select id, parent, `name`, sort from category order by sort asc
2021-09-24 15:31:24.054 DEBUG c.o.wiki.mapper.CategoryMapper.selectByExample    :137  [32m377754157798400   [0;39m ==> Parameters: 
2021-09-24 15:31:24.055 INFO  c.o.wiki.interceptor.LoginInterceptor             :29   [32m                  [0;39m ------------- LoginInterceptor 开始 -------------
2021-09-24 15:31:24.055 INFO  c.o.wiki.interceptor.LoginInterceptor             :40   [32m                  [0;39m 接口登录拦截：，path：http://localhost:8888/error
2021-09-24 15:31:24.055 INFO  c.o.wiki.interceptor.LoginInterceptor             :44   [32m                  [0;39m 登录校验开始，token：377738357888000
2021-09-24 15:31:24.056 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377754157798400   [0;39m <==    Columns: id, parent, name, sort
2021-09-24 15:31:24.056 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377754157798400   [0;39m <==        Row: 100, 0, 前端开发, 100
2021-09-24 15:31:24.057 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377754157798400   [0;39m <==        Row: 101, 100, Vue, 101
2021-09-24 15:31:24.057 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377754157798400   [0;39m <==        Row: 102, 100, Html, 102
2021-09-24 15:31:24.058 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377754157798400   [0;39m <==        Row: 200, 0, Java, 200
2021-09-24 15:31:24.059 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377754157798400   [0;39m <==        Row: 300, 0, MySql, 200
2021-09-24 15:31:24.059 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377754157798400   [0;39m <==        Row: 201, 200, 基础应用, 201
2021-09-24 15:31:24.059 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377754157798400   [0;39m <==        Row: 202, 200, 框架应用, 202
2021-09-24 15:31:24.060 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377754157798400   [0;39m <==        Row: 301, 300, 数据分析师, 301
2021-09-24 15:31:24.061 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377754157798400   [0;39m <==        Row: 302, 300, 数据工程师, 302
2021-09-24 15:31:24.061 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377754157798400   [0;39m <==        Row: 400, 0, 郭毛毛, 400
2021-09-24 15:31:24.062 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377754157798400   [0;39m <==        Row: 310978500236288, 400, 郭毛毛的大哥, 401
2021-09-24 15:31:24.062 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377754157798400   [0;39m <==        Row: 311011061306368, 400, 郭毛毛的二哥, 402
2021-09-24 15:31:24.063 DEBUG c.o.wiki.mapper.CategoryMapper.selectByExample    :137  [32m377754157798400   [0;39m <==      Total: 12
2021-09-24 15:31:24.075 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :92   [32m377754157798400   [0;39m 返回结果: {"content":[{"id":100,"name":"前端开发","parent":0,"sort":100},{"id":101,"name":"Vue","parent":100,"sort":101},{"id":102,"name":"Html","parent":100,"sort":102},{"id":200,"name":"Java","parent":0,"sort":200},{"id":300,"name":"MySql","parent":0,"sort":200},{"id":201,"name":"基础应用","parent":200,"sort":201},{"id":202,"name":"框架应用","parent":200,"sort":202},{"id":301,"name":"数据分析师","parent":300,"sort":301},{"id":302,"name":"数据工程师","parent":300,"sort":302},{"id":400,"name":"郭毛毛","parent":0,"sort":400},{"id":310978500236288,"name":"郭毛毛的大哥","parent":400,"sort":401},{"id":311011061306368,"name":"郭毛毛的二哥","parent":400,"sort":402}],"success":true}
2021-09-24 15:31:24.075 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :93   [32m377754157798400   [0;39m ------------- 结束 耗时：30 ms -------------
2021-09-24 15:31:24.626 INFO  c.o.wiki.interceptor.LoginInterceptor             :56   [32m                  [0;39m 已登录：{"id":319043990279168,"loginName":"test1","nickname":"ceshi1","token":"377738357888000"}
2021-09-24 15:31:24.668 INFO  c.o.wiki.interceptor.LoginInterceptor             :65   [32m                  [0;39m ------------- LoginInterceptor 结束 耗时：613 ms -------------
2021-09-24 15:31:30.008 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377754255496192   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:31:30.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377754255496192   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:31:30.010 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377754255496192   [0;39m ==> Parameters: 
2021-09-24 15:31:30.011 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377754255496192   [0;39m <==    Updates: 4
2021-09-24 15:31:30.012 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377754255496192   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:31:35.012 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377754337481728   [0;39m 生成今日电子书快照开始
2021-09-24 15:31:35.014 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377754337481728   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:31:35.015 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377754337481728   [0;39m ==> Parameters: 
2021-09-24 15:31:35.017 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377754337481728   [0;39m <==    Updates: 0
2021-09-24 15:31:35.017 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377754337481728   [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-09-24 15:32:00.012 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377754747081728   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:32:00.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377754747081728   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:32:00.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377754747081728   [0;39m ==> Parameters: 
2021-09-24 15:32:00.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377754747081728   [0;39m <==    Updates: 4
2021-09-24 15:32:00.017 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377754747081728   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:32:05.008 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377754828936192   [0;39m 生成今日电子书快照开始
2021-09-24 15:32:05.012 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377754828936192   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:32:05.014 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377754828936192   [0;39m ==> Parameters: 
2021-09-24 15:32:05.017 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377754828936192   [0;39m <==    Updates: 0
2021-09-24 15:32:05.017 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377754828936192   [0;39m 生成今日电子书快照结束，耗时：6毫秒
2021-09-24 15:32:30.010 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377755238568960   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:32:30.011 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377755238568960   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:32:30.012 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377755238568960   [0;39m ==> Parameters: 
2021-09-24 15:32:30.013 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377755238568960   [0;39m <==    Updates: 4
2021-09-24 15:32:30.014 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377755238568960   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:32:35.007 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377755320439808   [0;39m 生成今日电子书快照开始
2021-09-24 15:32:35.044 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377755320439808   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:32:35.045 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377755320439808   [0;39m ==> Parameters: 
2021-09-24 15:32:35.048 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377755320439808   [0;39m <==    Updates: 0
2021-09-24 15:32:35.048 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377755320439808   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:33:00.014 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377755730154496   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:33:00.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377755730154496   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:33:00.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377755730154496   [0;39m ==> Parameters: 
2021-09-24 15:33:00.018 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377755730154496   [0;39m <==    Updates: 4
2021-09-24 15:33:00.019 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377755730154496   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:33:02.560 INFO  c.o.wiki.websocket.WebSocketServer                :41   [32m                  [0;39m 连接关闭，token：8S2WWfV5kM，session id：2！当前连接数：0
2021-09-24 15:33:04.000 INFO  c.o.wiki.websocket.WebSocketServer                :32   [32m                  [0;39m 有新连接：token：iYYKx0lIPb，session id：3，当前连接数：1
2021-09-24 15:33:04.153 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :55   [32m377755797967872   [0;39m ------------- 开始 -------------
2021-09-24 15:33:04.154 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :56   [32m377755797967872   [0;39m 请求地址: http://localhost:8888/category/all GET
2021-09-24 15:33:04.155 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :57   [32m377755797967872   [0;39m 类名方法: com.orange_yishenggong.wiki.controller.CategoryController.all
2021-09-24 15:33:04.155 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :58   [32m377755797967872   [0;39m 远程地址: 0:0:0:0:0:0:0:1
2021-09-24 15:33:04.156 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :80   [32m377755797967872   [0;39m 请求参数: []
2021-09-24 15:33:04.157 DEBUG c.o.wiki.mapper.CategoryMapper.selectByExample    :137  [32m377755797967872   [0;39m ==>  Preparing: select id, parent, `name`, sort from category order by sort asc
2021-09-24 15:33:04.158 DEBUG c.o.wiki.mapper.CategoryMapper.selectByExample    :137  [32m377755797967872   [0;39m ==> Parameters: 
2021-09-24 15:33:04.160 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377755797967872   [0;39m <==    Columns: id, parent, name, sort
2021-09-24 15:33:04.160 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377755797967872   [0;39m <==        Row: 100, 0, 前端开发, 100
2021-09-24 15:33:04.161 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377755797967872   [0;39m <==        Row: 101, 100, Vue, 101
2021-09-24 15:33:04.162 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377755797967872   [0;39m <==        Row: 102, 100, Html, 102
2021-09-24 15:33:04.162 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377755797967872   [0;39m <==        Row: 200, 0, Java, 200
2021-09-24 15:33:04.163 INFO  c.o.wiki.interceptor.LoginInterceptor             :29   [32m                  [0;39m ------------- LoginInterceptor 开始 -------------
2021-09-24 15:33:04.164 INFO  c.o.wiki.interceptor.LoginInterceptor             :40   [32m                  [0;39m 接口登录拦截：，path：http://localhost:8888/error
2021-09-24 15:33:04.164 INFO  c.o.wiki.interceptor.LoginInterceptor             :44   [32m                  [0;39m 登录校验开始，token：377738357888000
2021-09-24 15:33:04.164 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377755797967872   [0;39m <==        Row: 300, 0, MySql, 200
2021-09-24 15:33:04.165 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377755797967872   [0;39m <==        Row: 201, 200, 基础应用, 201
2021-09-24 15:33:04.165 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377755797967872   [0;39m <==        Row: 202, 200, 框架应用, 202
2021-09-24 15:33:04.166 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377755797967872   [0;39m <==        Row: 301, 300, 数据分析师, 301
2021-09-24 15:33:04.166 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377755797967872   [0;39m <==        Row: 302, 300, 数据工程师, 302
2021-09-24 15:33:04.166 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377755797967872   [0;39m <==        Row: 400, 0, 郭毛毛, 400
2021-09-24 15:33:04.167 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377755797967872   [0;39m <==        Row: 310978500236288, 400, 郭毛毛的大哥, 401
2021-09-24 15:33:04.168 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377755797967872   [0;39m <==        Row: 311011061306368, 400, 郭毛毛的二哥, 402
2021-09-24 15:33:04.168 DEBUG c.o.wiki.mapper.CategoryMapper.selectByExample    :137  [32m377755797967872   [0;39m <==      Total: 12
2021-09-24 15:33:04.172 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :92   [32m377755797967872   [0;39m 返回结果: {"content":[{"id":100,"name":"前端开发","parent":0,"sort":100},{"id":101,"name":"Vue","parent":100,"sort":101},{"id":102,"name":"Html","parent":100,"sort":102},{"id":200,"name":"Java","parent":0,"sort":200},{"id":300,"name":"MySql","parent":0,"sort":200},{"id":201,"name":"基础应用","parent":200,"sort":201},{"id":202,"name":"框架应用","parent":200,"sort":202},{"id":301,"name":"数据分析师","parent":300,"sort":301},{"id":302,"name":"数据工程师","parent":300,"sort":302},{"id":400,"name":"郭毛毛","parent":0,"sort":400},{"id":310978500236288,"name":"郭毛毛的大哥","parent":400,"sort":401},{"id":311011061306368,"name":"郭毛毛的二哥","parent":400,"sort":402}],"success":true}
2021-09-24 15:33:04.172 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :93   [32m377755797967872   [0;39m ------------- 结束 耗时：19 ms -------------
2021-09-24 15:33:04.410 INFO  c.o.wiki.interceptor.LoginInterceptor             :56   [32m                  [0;39m 已登录：{"id":319043990279168,"loginName":"test1","nickname":"ceshi1","token":"377738357888000"}
2021-09-24 15:33:04.412 INFO  c.o.wiki.interceptor.LoginInterceptor             :65   [32m                  [0;39m ------------- LoginInterceptor 结束 耗时：248 ms -------------
2021-09-24 15:33:05.009 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377755811992576   [0;39m 生成今日电子书快照开始
2021-09-24 15:33:05.010 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377755811992576   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:33:05.012 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377755811992576   [0;39m ==> Parameters: 
2021-09-24 15:33:05.014 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377755811992576   [0;39m <==    Updates: 0
2021-09-24 15:33:05.014 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377755811992576   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:33:11.490 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :55   [32m377755918177280   [0;39m ------------- 开始 -------------
2021-09-24 15:33:11.490 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :56   [32m377755918177280   [0;39m 请求地址: http://localhost:8888/ebook-snapshot/get-statistic GET
2021-09-24 15:33:11.490 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :57   [32m377755918177280   [0;39m 类名方法: com.orange_yishenggong.wiki.controller.EbookSnapshotController.getStatistic
2021-09-24 15:33:11.490 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :58   [32m377755918177280   [0;39m 远程地址: 0:0:0:0:0:0:0:1
2021-09-24 15:33:11.491 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :80   [32m377755918177280   [0;39m 请求参数: []
2021-09-24 15:33:11.494 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377755918177280   [0;39m ==>  Preparing: select t1.`date` as `date`, sum(t1.view_count) as viewCount, sum(t1.vote_count) as voteCount, sum(t1.view_increase) as viewIncrease, sum(t1.vote_increase) as voteIncrease from ebook_snapshot t1 where t1.`date` >= date_sub(curdate(), interval 1 day) group by t1.`date` order by t1.`date` asc;
2021-09-24 15:33:11.495 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377755918177280   [0;39m ==> Parameters: 
2021-09-24 15:33:11.496 TRACE c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m377755918177280   [0;39m <==    Columns: date, viewCount, voteCount, viewIncrease, voteIncrease
2021-09-24 15:33:11.497 TRACE c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m377755918177280   [0;39m <==        Row: 2021-09-24, 8889023, 1000000076, 8889023, 1000000076
2021-09-24 15:33:11.500 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377755918177280   [0;39m <==      Total: 1
2021-09-24 15:33:11.505 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :92   [32m377755918177280   [0;39m 返回结果: {"content":[{"date":1632459600000,"viewCount":8889023,"viewIncrease":8889023,"voteCount":1000000076,"voteIncrease":1000000076}],"success":true}
2021-09-24 15:33:11.505 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :93   [32m377755918177280   [0;39m ------------- 结束 耗时：15 ms -------------
2021-09-24 15:33:11.673 INFO  c.o.wiki.websocket.WebSocketServer                :41   [32m                  [0;39m 连接关闭，token：iYYKx0lIPb，session id：3！当前连接数：0
2021-09-24 15:33:13.386 INFO  c.o.wiki.websocket.WebSocketServer                :32   [32m377738349302784   [0;39m 有新连接：token：tUD0NICnok，session id：4，当前连接数：1
2021-09-24 15:33:13.538 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :55   [32m377755951731712   [0;39m ------------- 开始 -------------
2021-09-24 15:33:13.538 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :55   [32m377755951731713   [0;39m ------------- 开始 -------------
2021-09-24 15:33:13.538 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :56   [32m377755951731712   [0;39m 请求地址: http://localhost:8888/category/all GET
2021-09-24 15:33:13.539 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :56   [32m377755951731713   [0;39m 请求地址: http://localhost:8888/ebook-snapshot/get-statistic GET
2021-09-24 15:33:13.539 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :57   [32m377755951731712   [0;39m 类名方法: com.orange_yishenggong.wiki.controller.CategoryController.all
2021-09-24 15:33:13.540 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :58   [32m377755951731712   [0;39m 远程地址: 0:0:0:0:0:0:0:1
2021-09-24 15:33:13.539 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :57   [32m377755951731713   [0;39m 类名方法: com.orange_yishenggong.wiki.controller.EbookSnapshotController.getStatistic
2021-09-24 15:33:13.540 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :80   [32m377755951731712   [0;39m 请求参数: []
2021-09-24 15:33:13.540 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :58   [32m377755951731713   [0;39m 远程地址: 0:0:0:0:0:0:0:1
2021-09-24 15:33:13.540 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :80   [32m377755951731713   [0;39m 请求参数: []
2021-09-24 15:33:13.541 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377755951731713   [0;39m ==>  Preparing: select t1.`date` as `date`, sum(t1.view_count) as viewCount, sum(t1.vote_count) as voteCount, sum(t1.view_increase) as viewIncrease, sum(t1.vote_increase) as voteIncrease from ebook_snapshot t1 where t1.`date` >= date_sub(curdate(), interval 1 day) group by t1.`date` order by t1.`date` asc;
2021-09-24 15:33:13.541 DEBUG c.o.wiki.mapper.CategoryMapper.selectByExample    :137  [32m377755951731712   [0;39m ==>  Preparing: select id, parent, `name`, sort from category order by sort asc
2021-09-24 15:33:13.542 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377755951731713   [0;39m ==> Parameters: 
2021-09-24 15:33:13.542 DEBUG c.o.wiki.mapper.CategoryMapper.selectByExample    :137  [32m377755951731712   [0;39m ==> Parameters: 
2021-09-24 15:33:13.544 TRACE c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m377755951731713   [0;39m <==    Columns: date, viewCount, voteCount, viewIncrease, voteIncrease
2021-09-24 15:33:13.544 TRACE c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m377755951731713   [0;39m <==        Row: 2021-09-24, 8889023, 1000000076, 8889023, 1000000076
2021-09-24 15:33:13.544 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377755951731712   [0;39m <==    Columns: id, parent, name, sort
2021-09-24 15:33:13.545 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377755951731712   [0;39m <==        Row: 100, 0, 前端开发, 100
2021-09-24 15:33:13.545 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377755951731713   [0;39m <==      Total: 1
2021-09-24 15:33:13.545 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377755951731712   [0;39m <==        Row: 101, 100, Vue, 101
2021-09-24 15:33:13.545 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377755951731712   [0;39m <==        Row: 102, 100, Html, 102
2021-09-24 15:33:13.546 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377755951731712   [0;39m <==        Row: 200, 0, Java, 200
2021-09-24 15:33:13.546 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :92   [32m377755951731713   [0;39m 返回结果: {"content":[{"date":1632459600000,"viewCount":8889023,"viewIncrease":8889023,"voteCount":1000000076,"voteIncrease":1000000076}],"success":true}
2021-09-24 15:33:13.546 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :93   [32m377755951731713   [0;39m ------------- 结束 耗时：8 ms -------------
2021-09-24 15:33:13.546 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377755951731712   [0;39m <==        Row: 300, 0, MySql, 200
2021-09-24 15:33:13.547 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377755951731712   [0;39m <==        Row: 201, 200, 基础应用, 201
2021-09-24 15:33:13.547 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377755951731712   [0;39m <==        Row: 202, 200, 框架应用, 202
2021-09-24 15:33:13.547 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377755951731712   [0;39m <==        Row: 301, 300, 数据分析师, 301
2021-09-24 15:33:13.547 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377755951731712   [0;39m <==        Row: 302, 300, 数据工程师, 302
2021-09-24 15:33:13.548 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377755951731712   [0;39m <==        Row: 400, 0, 郭毛毛, 400
2021-09-24 15:33:13.548 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377755951731712   [0;39m <==        Row: 310978500236288, 400, 郭毛毛的大哥, 401
2021-09-24 15:33:13.548 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377755951731712   [0;39m <==        Row: 311011061306368, 400, 郭毛毛的二哥, 402
2021-09-24 15:33:13.549 DEBUG c.o.wiki.mapper.CategoryMapper.selectByExample    :137  [32m377755951731712   [0;39m <==      Total: 12
2021-09-24 15:33:13.550 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :92   [32m377755951731712   [0;39m 返回结果: {"content":[{"id":100,"name":"前端开发","parent":0,"sort":100},{"id":101,"name":"Vue","parent":100,"sort":101},{"id":102,"name":"Html","parent":100,"sort":102},{"id":200,"name":"Java","parent":0,"sort":200},{"id":300,"name":"MySql","parent":0,"sort":200},{"id":201,"name":"基础应用","parent":200,"sort":201},{"id":202,"name":"框架应用","parent":200,"sort":202},{"id":301,"name":"数据分析师","parent":300,"sort":301},{"id":302,"name":"数据工程师","parent":300,"sort":302},{"id":400,"name":"郭毛毛","parent":0,"sort":400},{"id":310978500236288,"name":"郭毛毛的大哥","parent":400,"sort":401},{"id":311011061306368,"name":"郭毛毛的二哥","parent":400,"sort":402}],"success":true}
2021-09-24 15:33:13.550 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :93   [32m377755951731712   [0;39m ------------- 结束 耗时：12 ms -------------
2021-09-24 15:33:30.003 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377756221494272   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:33:30.005 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377756221494272   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:33:30.005 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377756221494272   [0;39m ==> Parameters: 
2021-09-24 15:33:30.007 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377756221494272   [0;39m <==    Updates: 4
2021-09-24 15:33:30.007 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377756221494272   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 15:33:35.011 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377756303545344   [0;39m 生成今日电子书快照开始
2021-09-24 15:33:35.013 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377756303545344   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:33:35.015 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377756303545344   [0;39m ==> Parameters: 
2021-09-24 15:33:35.017 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377756303545344   [0;39m <==    Updates: 0
2021-09-24 15:33:35.018 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377756303545344   [0;39m 生成今日电子书快照结束，耗时：6毫秒
2021-09-24 15:34:00.005 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377756713047040   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:34:00.007 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377756713047040   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:34:00.007 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377756713047040   [0;39m ==> Parameters: 
2021-09-24 15:34:00.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377756713047040   [0;39m <==    Updates: 4
2021-09-24 15:34:00.009 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377756713047040   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 15:34:05.007 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377756794999808   [0;39m 生成今日电子书快照开始
2021-09-24 15:34:05.010 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377756794999808   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:34:05.011 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377756794999808   [0;39m ==> Parameters: 
2021-09-24 15:34:05.014 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377756794999808   [0;39m <==    Updates: 0
2021-09-24 15:34:05.014 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377756794999808   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:34:30.008 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377757204616192   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:34:30.010 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377757204616192   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:34:30.011 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377757204616192   [0;39m ==> Parameters: 
2021-09-24 15:34:30.013 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377757204616192   [0;39m <==    Updates: 4
2021-09-24 15:34:30.013 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377757204616192   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:34:35.016 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377757286667264   [0;39m 生成今日电子书快照开始
2021-09-24 15:34:35.018 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377757286667264   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:34:35.019 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377757286667264   [0;39m ==> Parameters: 
2021-09-24 15:34:35.021 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377757286667264   [0;39m <==    Updates: 0
2021-09-24 15:34:35.022 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377757286667264   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:35:00.014 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377757696234496   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:35:00.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377757696234496   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:35:00.017 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377757696234496   [0;39m ==> Parameters: 
2021-09-24 15:35:00.018 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377757696234496   [0;39m <==    Updates: 4
2021-09-24 15:35:00.019 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377757696234496   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:35:05.007 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377757778039808   [0;39m 生成今日电子书快照开始
2021-09-24 15:35:05.009 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377757778039808   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:35:05.010 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377757778039808   [0;39m ==> Parameters: 
2021-09-24 15:35:05.012 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377757778039808   [0;39m <==    Updates: 0
2021-09-24 15:35:05.013 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377757778039808   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:35:30.014 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377758187754496   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:35:30.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377758187754496   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:35:30.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377758187754496   [0;39m ==> Parameters: 
2021-09-24 15:35:30.018 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377758187754496   [0;39m <==    Updates: 4
2021-09-24 15:35:30.018 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377758187754496   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 15:35:35.002 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377758269477888   [0;39m 生成今日电子书快照开始
2021-09-24 15:35:35.003 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377758269477888   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:35:35.004 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377758269477888   [0;39m ==> Parameters: 
2021-09-24 15:35:35.007 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377758269477888   [0;39m <==    Updates: 0
2021-09-24 15:35:35.007 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377758269477888   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:35:50.900 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :55   [32m377758529950720   [0;39m ------------- 开始 -------------
2021-09-24 15:35:50.901 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :56   [32m377758529950720   [0;39m 请求地址: http://localhost:8888/ebook-snapshot/get-statistic GET
2021-09-24 15:35:50.901 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :57   [32m377758529950720   [0;39m 类名方法: com.orange_yishenggong.wiki.controller.EbookSnapshotController.getStatistic
2021-09-24 15:35:50.901 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :58   [32m377758529950720   [0;39m 远程地址: 0:0:0:0:0:0:0:1
2021-09-24 15:35:50.902 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :80   [32m377758529950720   [0;39m 请求参数: []
2021-09-24 15:35:50.903 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377758529950720   [0;39m ==>  Preparing: select t1.`date` as `date`, sum(t1.view_count) as viewCount, sum(t1.vote_count) as voteCount, sum(t1.view_increase) as viewIncrease, sum(t1.vote_increase) as voteIncrease from ebook_snapshot t1 where t1.`date` >= date_sub(curdate(), interval 1 day) group by t1.`date` order by t1.`date` asc;
2021-09-24 15:35:50.903 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377758529950720   [0;39m ==> Parameters: 
2021-09-24 15:35:50.940 TRACE c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m377758529950720   [0;39m <==    Columns: date, viewCount, voteCount, viewIncrease, voteIncrease
2021-09-24 15:35:50.941 TRACE c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m377758529950720   [0;39m <==        Row: 2021-09-24, 8889023, 1000000076, 8889023, 1000000076
2021-09-24 15:35:50.942 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377758529950720   [0;39m <==      Total: 1
2021-09-24 15:35:50.942 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :92   [32m377758529950720   [0;39m 返回结果: {"content":[{"date":1632459600000,"viewCount":8889023,"viewIncrease":8889023,"voteCount":1000000076,"voteIncrease":1000000076}],"success":true}
2021-09-24 15:35:50.943 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :93   [32m377758529950720   [0;39m ------------- 结束 耗时：43 ms -------------
2021-09-24 15:36:00.002 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377758679077888   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:36:00.004 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377758679077888   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:36:00.004 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377758679077888   [0;39m ==> Parameters: 
2021-09-24 15:36:00.005 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377758679077888   [0;39m <==    Updates: 4
2021-09-24 15:36:00.005 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377758679077888   [0;39m 更新电子书下的文档数据结束，耗时：2毫秒
2021-09-24 15:36:05.003 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377758761014272   [0;39m 生成今日电子书快照开始
2021-09-24 15:36:05.005 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377758761014272   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:36:05.006 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377758761014272   [0;39m ==> Parameters: 
2021-09-24 15:36:05.009 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377758761014272   [0;39m <==    Updates: 0
2021-09-24 15:36:05.010 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377758761014272   [0;39m 生成今日电子书快照结束，耗时：6毫秒
2021-09-24 15:36:30.012 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377759170761728   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:36:30.013 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377759170761728   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:36:30.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377759170761728   [0;39m ==> Parameters: 
2021-09-24 15:36:30.015 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377759170761728   [0;39m <==    Updates: 4
2021-09-24 15:36:30.016 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377759170761728   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 15:36:35.007 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377759252599808   [0;39m 生成今日电子书快照开始
2021-09-24 15:36:35.009 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377759252599808   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:36:35.010 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377759252599808   [0;39m ==> Parameters: 
2021-09-24 15:36:35.012 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377759252599808   [0;39m <==    Updates: 0
2021-09-24 15:36:35.012 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377759252599808   [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-09-24 15:36:43.379 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :55   [32m377759389766656   [0;39m ------------- 开始 -------------
2021-09-24 15:36:43.380 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :56   [32m377759389766656   [0;39m 请求地址: http://localhost:8888/ebook-snapshot/get-statistic GET
2021-09-24 15:36:43.380 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :57   [32m377759389766656   [0;39m 类名方法: com.orange_yishenggong.wiki.controller.EbookSnapshotController.getStatistic
2021-09-24 15:36:43.380 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :58   [32m377759389766656   [0;39m 远程地址: 127.0.0.1
2021-09-24 15:36:43.381 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :80   [32m377759389766656   [0;39m 请求参数: []
2021-09-24 15:36:43.382 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377759389766656   [0;39m ==>  Preparing: select t1.`date` as `date`, sum(t1.view_count) as viewCount, sum(t1.vote_count) as voteCount, sum(t1.view_increase) as viewIncrease, sum(t1.vote_increase) as voteIncrease from ebook_snapshot t1 where t1.`date` >= date_sub(curdate(), interval 1 day) group by t1.`date` order by t1.`date` asc;
2021-09-24 15:36:43.382 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377759389766656   [0;39m ==> Parameters: 
2021-09-24 15:36:43.383 TRACE c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m377759389766656   [0;39m <==    Columns: date, viewCount, voteCount, viewIncrease, voteIncrease
2021-09-24 15:36:43.383 TRACE c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m377759389766656   [0;39m <==        Row: 2021-09-24, 8889023, 1000000076, 8889023, 1000000076
2021-09-24 15:36:43.384 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377759389766656   [0;39m <==      Total: 1
2021-09-24 15:36:43.384 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :92   [32m377759389766656   [0;39m 返回结果: {"content":[{"date":1632459600000,"viewCount":8889023,"viewIncrease":8889023,"voteCount":1000000076,"voteIncrease":1000000076}],"success":true}
2021-09-24 15:36:43.384 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :93   [32m377759389766656   [0;39m ------------- 结束 耗时：5 ms -------------
2021-09-24 15:36:52.679 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :55   [32m377759542137856   [0;39m ------------- 开始 -------------
2021-09-24 15:36:52.680 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :56   [32m377759542137856   [0;39m 请求地址: http://localhost:8888/ebook-snapshot/get-statistic GET
2021-09-24 15:36:52.680 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :57   [32m377759542137856   [0;39m 类名方法: com.orange_yishenggong.wiki.controller.EbookSnapshotController.getStatistic
2021-09-24 15:36:52.680 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :58   [32m377759542137856   [0;39m 远程地址: 127.0.0.1
2021-09-24 15:36:52.680 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :80   [32m377759542137856   [0;39m 请求参数: []
2021-09-24 15:36:52.681 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377759542137856   [0;39m ==>  Preparing: select t1.`date` as `date`, sum(t1.view_count) as viewCount, sum(t1.vote_count) as voteCount, sum(t1.view_increase) as viewIncrease, sum(t1.vote_increase) as voteIncrease from ebook_snapshot t1 where t1.`date` >= date_sub(curdate(), interval 1 day) group by t1.`date` order by t1.`date` asc;
2021-09-24 15:36:52.682 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377759542137856   [0;39m ==> Parameters: 
2021-09-24 15:36:52.684 TRACE c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m377759542137856   [0;39m <==    Columns: date, viewCount, voteCount, viewIncrease, voteIncrease
2021-09-24 15:36:52.684 TRACE c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m377759542137856   [0;39m <==        Row: 2021-09-24, 8889023, 1000000076, 8889023, 1000000076
2021-09-24 15:36:52.685 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377759542137856   [0;39m <==      Total: 1
2021-09-24 15:36:52.686 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :92   [32m377759542137856   [0;39m 返回结果: {"content":[{"date":1632459600000,"viewCount":8889023,"viewIncrease":8889023,"voteCount":1000000076,"voteIncrease":1000000076}],"success":true}
2021-09-24 15:36:52.686 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :93   [32m377759542137856   [0;39m ------------- 结束 耗时：7 ms -------------
2021-09-24 15:37:00.013 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377759662298112   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:37:00.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377759662298112   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:37:00.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377759662298112   [0;39m ==> Parameters: 
2021-09-24 15:37:00.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377759662298112   [0;39m <==    Updates: 4
2021-09-24 15:37:00.017 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377759662298112   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:37:05.006 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377759744103424   [0;39m 生成今日电子书快照开始
2021-09-24 15:37:05.008 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377759744103424   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:37:05.009 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377759744103424   [0;39m ==> Parameters: 
2021-09-24 15:37:05.012 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377759744103424   [0;39m <==    Updates: 0
2021-09-24 15:37:05.012 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377759744103424   [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-09-24 15:37:27.980 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :55   [32m377760120509440   [0;39m ------------- 开始 -------------
2021-09-24 15:37:27.981 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :56   [32m377760120509440   [0;39m 请求地址: http://localhost:8888/ebook-snapshot/get-statistic GET
2021-09-24 15:37:27.981 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :57   [32m377760120509440   [0;39m 类名方法: com.orange_yishenggong.wiki.controller.EbookSnapshotController.getStatistic
2021-09-24 15:37:27.982 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :58   [32m377760120509440   [0;39m 远程地址: 127.0.0.1
2021-09-24 15:37:27.982 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :80   [32m377760120509440   [0;39m 请求参数: []
2021-09-24 15:37:27.983 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377760120509440   [0;39m ==>  Preparing: select t1.`date` as `date`, sum(t1.view_count) as viewCount, sum(t1.vote_count) as voteCount, sum(t1.view_increase) as viewIncrease, sum(t1.vote_increase) as voteIncrease from ebook_snapshot t1 where t1.`date` >= date_sub(curdate(), interval 1 day) group by t1.`date` order by t1.`date` asc;
2021-09-24 15:37:27.983 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377760120509440   [0;39m ==> Parameters: 
2021-09-24 15:37:28.020 TRACE c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m377760120509440   [0;39m <==    Columns: date, viewCount, voteCount, viewIncrease, voteIncrease
2021-09-24 15:37:28.021 TRACE c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m377760120509440   [0;39m <==        Row: 2021-09-24, 8889023, 1000000076, 8889023, 1000000076
2021-09-24 15:37:28.021 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377760120509440   [0;39m <==      Total: 1
2021-09-24 15:37:28.022 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :92   [32m377760120509440   [0;39m 返回结果: {"content":[{"date":1632459600000,"viewCount":8889023,"viewIncrease":8889023,"voteCount":1000000076,"voteIncrease":1000000076}],"success":true}
2021-09-24 15:37:28.022 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :93   [32m377760120509440   [0;39m ------------- 结束 耗时：42 ms -------------
2021-09-24 15:37:30.012 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377760153801728   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:37:30.013 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377760153801728   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:37:30.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377760153801728   [0;39m ==> Parameters: 
2021-09-24 15:37:30.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377760153801728   [0;39m <==    Updates: 4
2021-09-24 15:37:30.016 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377760153801728   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:37:35.013 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377760235738112   [0;39m 生成今日电子书快照开始
2021-09-24 15:37:35.015 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377760235738112   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:37:35.016 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377760235738112   [0;39m ==> Parameters: 
2021-09-24 15:37:35.018 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377760235738112   [0;39m <==    Updates: 0
2021-09-24 15:37:35.019 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377760235738112   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:38:00.009 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377760645272576   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:38:00.011 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377760645272576   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:38:00.011 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377760645272576   [0;39m ==> Parameters: 
2021-09-24 15:38:00.013 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377760645272576   [0;39m <==    Updates: 4
2021-09-24 15:38:00.014 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377760645272576   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:38:05.001 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377760727061504   [0;39m 生成今日电子书快照开始
2021-09-24 15:38:05.003 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377760727061504   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:38:05.004 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377760727061504   [0;39m ==> Parameters: 
2021-09-24 15:38:05.006 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377760727061504   [0;39m <==    Updates: 0
2021-09-24 15:38:05.007 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377760727061504   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:38:05.174 INFO  c.o.wiki.websocket.WebSocketServer                :41   [32m                  [0;39m 连接关闭，token：tUD0NICnok，session id：4！当前连接数：0
2021-09-24 15:38:06.588 INFO  c.o.wiki.websocket.WebSocketServer                :32   [32m                  [0;39m 有新连接：token：9JEMGegKTd，session id：5，当前连接数：1
2021-09-24 15:38:06.723 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :55   [32m377760755274752   [0;39m ------------- 开始 -------------
2021-09-24 15:38:06.724 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :56   [32m377760755274752   [0;39m 请求地址: http://localhost:8888/ebook-snapshot/get-statistic GET
2021-09-24 15:38:06.724 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :57   [32m377760755274752   [0;39m 类名方法: com.orange_yishenggong.wiki.controller.EbookSnapshotController.getStatistic
2021-09-24 15:38:06.724 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :55   [32m377760755291136   [0;39m ------------- 开始 -------------
2021-09-24 15:38:06.724 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :58   [32m377760755274752   [0;39m 远程地址: 0:0:0:0:0:0:0:1
2021-09-24 15:38:06.725 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :56   [32m377760755291136   [0;39m 请求地址: http://localhost:8888/category/all GET
2021-09-24 15:38:06.725 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :80   [32m377760755274752   [0;39m 请求参数: []
2021-09-24 15:38:06.725 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :57   [32m377760755291136   [0;39m 类名方法: com.orange_yishenggong.wiki.controller.CategoryController.all
2021-09-24 15:38:06.725 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :58   [32m377760755291136   [0;39m 远程地址: 0:0:0:0:0:0:0:1
2021-09-24 15:38:06.725 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :80   [32m377760755291136   [0;39m 请求参数: []
2021-09-24 15:38:06.726 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377760755274752   [0;39m ==>  Preparing: select t1.`date` as `date`, sum(t1.view_count) as viewCount, sum(t1.vote_count) as voteCount, sum(t1.view_increase) as viewIncrease, sum(t1.vote_increase) as voteIncrease from ebook_snapshot t1 where t1.`date` >= date_sub(curdate(), interval 1 day) group by t1.`date` order by t1.`date` asc;
2021-09-24 15:38:06.726 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377760755274752   [0;39m ==> Parameters: 
2021-09-24 15:38:06.727 DEBUG c.o.wiki.mapper.CategoryMapper.selectByExample    :137  [32m377760755291136   [0;39m ==>  Preparing: select id, parent, `name`, sort from category order by sort asc
2021-09-24 15:38:06.727 DEBUG c.o.wiki.mapper.CategoryMapper.selectByExample    :137  [32m377760755291136   [0;39m ==> Parameters: 
2021-09-24 15:38:06.728 TRACE c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m377760755274752   [0;39m <==    Columns: date, viewCount, voteCount, viewIncrease, voteIncrease
2021-09-24 15:38:06.728 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377760755291136   [0;39m <==    Columns: id, parent, name, sort
2021-09-24 15:38:06.728 TRACE c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m377760755274752   [0;39m <==        Row: 2021-09-24, 8889023, 1000000076, 8889023, 1000000076
2021-09-24 15:38:06.728 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377760755291136   [0;39m <==        Row: 100, 0, 前端开发, 100
2021-09-24 15:38:06.729 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377760755291136   [0;39m <==        Row: 101, 100, Vue, 101
2021-09-24 15:38:06.729 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377760755274752   [0;39m <==      Total: 1
2021-09-24 15:38:06.729 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377760755291136   [0;39m <==        Row: 102, 100, Html, 102
2021-09-24 15:38:06.729 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :92   [32m377760755274752   [0;39m 返回结果: {"content":[{"date":1632459600000,"viewCount":8889023,"viewIncrease":8889023,"voteCount":1000000076,"voteIncrease":1000000076}],"success":true}
2021-09-24 15:38:06.729 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377760755291136   [0;39m <==        Row: 200, 0, Java, 200
2021-09-24 15:38:06.729 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :93   [32m377760755274752   [0;39m ------------- 结束 耗时：6 ms -------------
2021-09-24 15:38:06.730 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377760755291136   [0;39m <==        Row: 300, 0, MySql, 200
2021-09-24 15:38:06.730 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377760755291136   [0;39m <==        Row: 201, 200, 基础应用, 201
2021-09-24 15:38:06.730 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377760755291136   [0;39m <==        Row: 202, 200, 框架应用, 202
2021-09-24 15:38:06.731 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377760755291136   [0;39m <==        Row: 301, 300, 数据分析师, 301
2021-09-24 15:38:06.731 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377760755291136   [0;39m <==        Row: 302, 300, 数据工程师, 302
2021-09-24 15:38:06.732 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377760755291136   [0;39m <==        Row: 400, 0, 郭毛毛, 400
2021-09-24 15:38:06.732 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377760755291136   [0;39m <==        Row: 310978500236288, 400, 郭毛毛的大哥, 401
2021-09-24 15:38:06.733 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377760755291136   [0;39m <==        Row: 311011061306368, 400, 郭毛毛的二哥, 402
2021-09-24 15:38:06.733 DEBUG c.o.wiki.mapper.CategoryMapper.selectByExample    :137  [32m377760755291136   [0;39m <==      Total: 12
2021-09-24 15:38:06.735 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :92   [32m377760755291136   [0;39m 返回结果: {"content":[{"id":100,"name":"前端开发","parent":0,"sort":100},{"id":101,"name":"Vue","parent":100,"sort":101},{"id":102,"name":"Html","parent":100,"sort":102},{"id":200,"name":"Java","parent":0,"sort":200},{"id":300,"name":"MySql","parent":0,"sort":200},{"id":201,"name":"基础应用","parent":200,"sort":201},{"id":202,"name":"框架应用","parent":200,"sort":202},{"id":301,"name":"数据分析师","parent":300,"sort":301},{"id":302,"name":"数据工程师","parent":300,"sort":302},{"id":400,"name":"郭毛毛","parent":0,"sort":400},{"id":310978500236288,"name":"郭毛毛的大哥","parent":400,"sort":401},{"id":311011061306368,"name":"郭毛毛的二哥","parent":400,"sort":402}],"success":true}
2021-09-24 15:38:06.735 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :93   [32m377760755291136   [0;39m ------------- 结束 耗时：11 ms -------------
2021-09-24 15:38:30.014 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377761136874496   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:38:30.015 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377761136874496   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:38:30.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377761136874496   [0;39m ==> Parameters: 
2021-09-24 15:38:30.018 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377761136874496   [0;39m <==    Updates: 4
2021-09-24 15:38:30.019 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377761136874496   [0;39m 更新电子书下的文档数据结束，耗时：5毫秒
2021-09-24 15:38:35.016 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377761218827264   [0;39m 生成今日电子书快照开始
2021-09-24 15:38:35.018 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377761218827264   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:38:35.019 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377761218827264   [0;39m ==> Parameters: 
2021-09-24 15:38:35.021 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377761218827264   [0;39m <==    Updates: 0
2021-09-24 15:38:35.021 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377761218827264   [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-09-24 15:39:00.002 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377761628197888   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:39:00.003 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377761628197888   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:39:00.004 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377761628197888   [0;39m ==> Parameters: 
2021-09-24 15:39:00.006 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377761628197888   [0;39m <==    Updates: 4
2021-09-24 15:39:00.006 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377761628197888   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 15:39:05.001 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377761710101504   [0;39m 生成今日电子书快照开始
2021-09-24 15:39:05.002 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377761710101504   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:39:05.003 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377761710101504   [0;39m ==> Parameters: 
2021-09-24 15:39:05.006 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377761710101504   [0;39m <==    Updates: 0
2021-09-24 15:39:05.006 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377761710101504   [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-09-24 15:39:30.013 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377762119898112   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:39:30.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377762119898112   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:39:30.015 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377762119898112   [0;39m ==> Parameters: 
2021-09-24 15:39:30.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377762119898112   [0;39m <==    Updates: 4
2021-09-24 15:39:30.017 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377762119898112   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 15:39:35.015 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377762201850880   [0;39m 生成今日电子书快照开始
2021-09-24 15:39:35.016 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377762201850880   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:39:35.016 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377762201850880   [0;39m ==> Parameters: 
2021-09-24 15:39:35.019 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377762201850880   [0;39m <==    Updates: 0
2021-09-24 15:39:35.019 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377762201850880   [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-09-24 15:40:00.004 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377762611270656   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:40:00.006 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377762611270656   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:40:00.006 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377762611270656   [0;39m ==> Parameters: 
2021-09-24 15:40:00.008 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377762611270656   [0;39m <==    Updates: 4
2021-09-24 15:40:00.008 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377762611270656   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 15:40:05.015 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377762693370880   [0;39m 生成今日电子书快照开始
2021-09-24 15:40:05.016 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377762693370880   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:40:05.017 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377762693370880   [0;39m ==> Parameters: 
2021-09-24 15:40:05.019 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377762693370880   [0;39m <==    Updates: 0
2021-09-24 15:40:05.020 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377762693370880   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:40:30.011 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377763102905344   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:40:30.013 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377763102905344   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:40:30.013 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377763102905344   [0;39m ==> Parameters: 
2021-09-24 15:40:30.015 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377763102905344   [0;39m <==    Updates: 4
2021-09-24 15:40:30.015 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377763102905344   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 15:40:35.009 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377763184792576   [0;39m 生成今日电子书快照开始
2021-09-24 15:40:35.011 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377763184792576   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:40:35.012 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377763184792576   [0;39m ==> Parameters: 
2021-09-24 15:40:35.014 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377763184792576   [0;39m <==    Updates: 0
2021-09-24 15:40:35.014 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377763184792576   [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-09-24 15:41:00.014 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377763594474496   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:41:00.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377763594474496   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:41:00.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377763594474496   [0;39m ==> Parameters: 
2021-09-24 15:41:00.018 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377763594474496   [0;39m <==    Updates: 4
2021-09-24 15:41:00.018 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377763594474496   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 15:41:05.006 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377763676263424   [0;39m 生成今日电子书快照开始
2021-09-24 15:41:05.008 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377763676263424   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:41:05.008 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377763676263424   [0;39m ==> Parameters: 
2021-09-24 15:41:05.056 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377763676263424   [0;39m <==    Updates: 17
2021-09-24 15:41:05.057 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377763676263424   [0;39m 生成今日电子书快照结束，耗时：50毫秒
2021-09-24 15:41:30.012 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377764085961728   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:41:30.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377764085961728   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:41:30.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377764085961728   [0;39m ==> Parameters: 
2021-09-24 15:41:30.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377764085961728   [0;39m <==    Updates: 4
2021-09-24 15:41:30.016 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377764085961728   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 15:41:35.002 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377764167717888   [0;39m 生成今日电子书快照开始
2021-09-24 15:41:35.004 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377764167717888   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:41:35.004 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377764167717888   [0;39m ==> Parameters: 
2021-09-24 15:41:35.046 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377764167717888   [0;39m <==    Updates: 0
2021-09-24 15:41:35.046 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377764167717888   [0;39m 生成今日电子书快照结束，耗时：43毫秒
2021-09-24 15:41:54.339 INFO  c.o.wiki.websocket.WebSocketServer                :41   [32m377759542137856   [0;39m 连接关闭，token：9JEMGegKTd，session id：5！当前连接数：0
2021-09-24 15:41:55.145 INFO  c.o.wiki.websocket.WebSocketServer                :32   [32m377738349302784   [0;39m 有新连接：token：Vcf7zOumg1，session id：6，当前连接数：1
2021-09-24 15:41:55.238 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :55   [32m377764499264513   [0;39m ------------- 开始 -------------
2021-09-24 15:41:55.238 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :55   [32m377764499264512   [0;39m ------------- 开始 -------------
2021-09-24 15:41:55.238 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :56   [32m377764499264513   [0;39m 请求地址: http://localhost:8888/category/all GET
2021-09-24 15:41:55.239 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :57   [32m377764499264513   [0;39m 类名方法: com.orange_yishenggong.wiki.controller.CategoryController.all
2021-09-24 15:41:55.238 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :56   [32m377764499264512   [0;39m 请求地址: http://localhost:8888/ebook-snapshot/get-statistic GET
2021-09-24 15:41:55.239 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :58   [32m377764499264513   [0;39m 远程地址: 0:0:0:0:0:0:0:1
2021-09-24 15:41:55.239 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :57   [32m377764499264512   [0;39m 类名方法: com.orange_yishenggong.wiki.controller.EbookSnapshotController.getStatistic
2021-09-24 15:41:55.240 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :80   [32m377764499264513   [0;39m 请求参数: []
2021-09-24 15:41:55.240 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :58   [32m377764499264512   [0;39m 远程地址: 0:0:0:0:0:0:0:1
2021-09-24 15:41:55.240 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :80   [32m377764499264512   [0;39m 请求参数: []
2021-09-24 15:41:55.241 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377764499264512   [0;39m ==>  Preparing: select t1.`date` as `date`, sum(t1.view_count) as viewCount, sum(t1.vote_count) as voteCount, sum(t1.view_increase) as viewIncrease, sum(t1.vote_increase) as voteIncrease from ebook_snapshot t1 where t1.`date` >= date_sub(curdate(), interval 1 day) group by t1.`date` order by t1.`date` asc;
2021-09-24 15:41:55.241 DEBUG c.o.wiki.mapper.CategoryMapper.selectByExample    :137  [32m377764499264513   [0;39m ==>  Preparing: select id, parent, `name`, sort from category order by sort asc
2021-09-24 15:41:55.242 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377764499264512   [0;39m ==> Parameters: 
2021-09-24 15:41:55.242 DEBUG c.o.wiki.mapper.CategoryMapper.selectByExample    :137  [32m377764499264513   [0;39m ==> Parameters: 
2021-09-24 15:41:55.243 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377764499264513   [0;39m <==    Columns: id, parent, name, sort
2021-09-24 15:41:55.243 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377764499264513   [0;39m <==        Row: 100, 0, 前端开发, 100
2021-09-24 15:41:55.244 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377764499264513   [0;39m <==        Row: 101, 100, Vue, 101
2021-09-24 15:41:55.244 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377764499264513   [0;39m <==        Row: 102, 100, Html, 102
2021-09-24 15:41:55.244 TRACE c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m377764499264512   [0;39m <==    Columns: date, viewCount, voteCount, viewIncrease, voteIncrease
2021-09-24 15:41:55.244 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377764499264513   [0;39m <==        Row: 200, 0, Java, 200
2021-09-24 15:41:55.245 TRACE c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m377764499264512   [0;39m <==        Row: 2021-09-23, 8889022, 100000076, 8889023, 1000000076
2021-09-24 15:41:55.245 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377764499264513   [0;39m <==        Row: 300, 0, MySql, 200
2021-09-24 15:41:55.245 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377764499264513   [0;39m <==        Row: 201, 200, 基础应用, 201
2021-09-24 15:41:55.245 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377764499264513   [0;39m <==        Row: 202, 200, 框架应用, 202
2021-09-24 15:41:55.245 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377764499264513   [0;39m <==        Row: 301, 300, 数据分析师, 301
2021-09-24 15:41:55.245 TRACE c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m377764499264512   [0;39m <==        Row: 2021-09-24, 8889023, 1000000076, 1, 900000000
2021-09-24 15:41:55.245 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377764499264513   [0;39m <==        Row: 302, 300, 数据工程师, 302
2021-09-24 15:41:55.246 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377764499264512   [0;39m <==      Total: 2
2021-09-24 15:41:55.246 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377764499264513   [0;39m <==        Row: 400, 0, 郭毛毛, 400
2021-09-24 15:41:55.246 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377764499264513   [0;39m <==        Row: 310978500236288, 400, 郭毛毛的大哥, 401
2021-09-24 15:41:55.246 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :92   [32m377764499264512   [0;39m 返回结果: {"content":[{"date":1632373200000,"viewCount":8889022,"viewIncrease":8889023,"voteCount":100000076,"voteIncrease":1000000076},{"date":1632459600000,"viewCount":8889023,"viewIncrease":1,"voteCount":1000000076,"voteIncrease":900000000}],"success":true}
2021-09-24 15:41:55.246 TRACE c.o.wiki.mapper.CategoryMapper.selectByExample    :143  [32m377764499264513   [0;39m <==        Row: 311011061306368, 400, 郭毛毛的二哥, 402
2021-09-24 15:41:55.246 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :93   [32m377764499264512   [0;39m ------------- 结束 耗时：8 ms -------------
2021-09-24 15:41:55.247 DEBUG c.o.wiki.mapper.CategoryMapper.selectByExample    :137  [32m377764499264513   [0;39m <==      Total: 12
2021-09-24 15:41:55.248 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :92   [32m377764499264513   [0;39m 返回结果: {"content":[{"id":100,"name":"前端开发","parent":0,"sort":100},{"id":101,"name":"Vue","parent":100,"sort":101},{"id":102,"name":"Html","parent":100,"sort":102},{"id":200,"name":"Java","parent":0,"sort":200},{"id":300,"name":"MySql","parent":0,"sort":200},{"id":201,"name":"基础应用","parent":200,"sort":201},{"id":202,"name":"框架应用","parent":200,"sort":202},{"id":301,"name":"数据分析师","parent":300,"sort":301},{"id":302,"name":"数据工程师","parent":300,"sort":302},{"id":400,"name":"郭毛毛","parent":0,"sort":400},{"id":310978500236288,"name":"郭毛毛的大哥","parent":400,"sort":401},{"id":311011061306368,"name":"郭毛毛的二哥","parent":400,"sort":402}],"success":true}
2021-09-24 15:41:55.248 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :93   [32m377764499264513   [0;39m ------------- 结束 耗时：10 ms -------------
2021-09-24 15:42:00.002 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377764577317888   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:42:00.004 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377764577317888   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:42:00.004 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377764577317888   [0;39m ==> Parameters: 
2021-09-24 15:42:00.006 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377764577317888   [0;39m <==    Updates: 4
2021-09-24 15:42:00.006 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377764577317888   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 15:42:05.001 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377764659221504   [0;39m 生成今日电子书快照开始
2021-09-24 15:42:05.002 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377764659221504   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:42:05.003 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377764659221504   [0;39m ==> Parameters: 
2021-09-24 15:42:05.005 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377764659221504   [0;39m <==    Updates: 0
2021-09-24 15:42:05.005 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377764659221504   [0;39m 生成今日电子书快照结束，耗时：3毫秒
2021-09-24 15:42:30.006 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377765068903424   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:42:30.007 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377765068903424   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:42:30.008 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377765068903424   [0;39m ==> Parameters: 
2021-09-24 15:42:30.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377765068903424   [0;39m <==    Updates: 4
2021-09-24 15:42:30.010 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377765068903424   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:42:35.006 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377765150823424   [0;39m 生成今日电子书快照开始
2021-09-24 15:42:35.007 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377765150823424   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:42:35.008 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377765150823424   [0;39m ==> Parameters: 
2021-09-24 15:42:35.010 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377765150823424   [0;39m <==    Updates: 0
2021-09-24 15:42:35.011 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377765150823424   [0;39m 生成今日电子书快照结束，耗时：4毫秒
2021-09-24 15:42:38.227 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :55   [32m377765203596288   [0;39m ------------- 开始 -------------
2021-09-24 15:42:38.228 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :56   [32m377765203596288   [0;39m 请求地址: http://localhost:8888/ebook-snapshot/get-statistic GET
2021-09-24 15:42:38.228 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :57   [32m377765203596288   [0;39m 类名方法: com.orange_yishenggong.wiki.controller.EbookSnapshotController.getStatistic
2021-09-24 15:42:38.228 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :58   [32m377765203596288   [0;39m 远程地址: 127.0.0.1
2021-09-24 15:42:38.229 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :80   [32m377765203596288   [0;39m 请求参数: []
2021-09-24 15:42:38.230 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377765203596288   [0;39m ==>  Preparing: select t1.`date` as `date`, sum(t1.view_count) as viewCount, sum(t1.vote_count) as voteCount, sum(t1.view_increase) as viewIncrease, sum(t1.vote_increase) as voteIncrease from ebook_snapshot t1 where t1.`date` >= date_sub(curdate(), interval 1 day) group by t1.`date` order by t1.`date` asc;
2021-09-24 15:42:38.230 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377765203596288   [0;39m ==> Parameters: 
2021-09-24 15:42:38.232 TRACE c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m377765203596288   [0;39m <==    Columns: date, viewCount, voteCount, viewIncrease, voteIncrease
2021-09-24 15:42:38.232 TRACE c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m377765203596288   [0;39m <==        Row: 2021-09-23, 8889022, 100000076, 8889023, 1000000076
2021-09-24 15:42:38.233 TRACE c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m377765203596288   [0;39m <==        Row: 2021-09-24, 8889023, 1000000076, 1, 900000000
2021-09-24 15:42:38.234 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377765203596288   [0;39m <==      Total: 2
2021-09-24 15:42:38.235 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :92   [32m377765203596288   [0;39m 返回结果: {"content":[{"date":1632373200000,"viewCount":8889022,"viewIncrease":8889023,"voteCount":100000076,"voteIncrease":1000000076},{"date":1632459600000,"viewCount":8889023,"viewIncrease":1,"voteCount":1000000076,"voteIncrease":900000000}],"success":true}
2021-09-24 15:42:38.235 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :93   [32m377765203596288   [0;39m ------------- 结束 耗时：8 ms -------------
2021-09-24 15:43:00.013 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377765560538112   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:43:00.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377765560538112   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:43:00.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377765560538112   [0;39m ==> Parameters: 
2021-09-24 15:43:00.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377765560538112   [0;39m <==    Updates: 4
2021-09-24 15:43:00.016 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377765560538112   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 15:43:05.011 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377765642425344   [0;39m 生成今日电子书快照开始
2021-09-24 15:43:05.046 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377765642425344   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:43:05.047 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377765642425344   [0;39m ==> Parameters: 
2021-09-24 15:43:05.050 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377765642425344   [0;39m <==    Updates: 0
2021-09-24 15:43:05.051 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377765642425344   [0;39m 生成今日电子书快照结束，耗时：28毫秒
2021-09-24 15:43:13.237 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :55   [32m377765777200128   [0;39m ------------- 开始 -------------
2021-09-24 15:43:13.238 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :56   [32m377765777200128   [0;39m 请求地址: http://localhost:8888/ebook-snapshot/get-statistic GET
2021-09-24 15:43:13.238 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :57   [32m377765777200128   [0;39m 类名方法: com.orange_yishenggong.wiki.controller.EbookSnapshotController.getStatistic
2021-09-24 15:43:13.238 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :58   [32m377765777200128   [0;39m 远程地址: 0:0:0:0:0:0:0:1
2021-09-24 15:43:13.238 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :80   [32m377765777200128   [0;39m 请求参数: []
2021-09-24 15:43:13.240 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377765777200128   [0;39m ==>  Preparing: select t1.`date` as `date`, sum(t1.view_count) as viewCount, sum(t1.vote_count) as voteCount, sum(t1.view_increase) as viewIncrease, sum(t1.vote_increase) as voteIncrease from ebook_snapshot t1 where t1.`date` >= date_sub(curdate(), interval 1 day) group by t1.`date` order by t1.`date` asc;
2021-09-24 15:43:13.240 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377765777200128   [0;39m ==> Parameters: 
2021-09-24 15:43:13.242 TRACE c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m377765777200128   [0;39m <==    Columns: date, viewCount, voteCount, viewIncrease, voteIncrease
2021-09-24 15:43:13.243 TRACE c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m377765777200128   [0;39m <==        Row: 2021-09-23, 8889022, 100000076, 8889023, 1000000076
2021-09-24 15:43:13.243 TRACE c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :143  [32m377765777200128   [0;39m <==        Row: 2021-09-24, 8889023, 1000000076, 1, 900000000
2021-09-24 15:43:13.244 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.getStatistic :137  [32m377765777200128   [0;39m <==      Total: 2
2021-09-24 15:43:13.245 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :92   [32m377765777200128   [0;39m 返回结果: {"content":[{"date":1632373200000,"viewCount":8889022,"viewIncrease":8889023,"voteCount":100000076,"voteIncrease":1000000076},{"date":1632459600000,"viewCount":8889023,"viewIncrease":1,"voteCount":1000000076,"voteIncrease":900000000}],"success":true}
2021-09-24 15:43:13.245 INFO  com.orange_yishenggong.wiki.aspect.LogAspect      :93   [32m377765777200128   [0;39m ------------- 结束 耗时：8 ms -------------
2021-09-24 15:43:30.007 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377766051959808   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:43:30.009 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377766051959808   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:43:30.010 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377766051959808   [0;39m ==> Parameters: 
2021-09-24 15:43:30.011 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377766051959808   [0;39m <==    Updates: 4
2021-09-24 15:43:30.011 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377766051959808   [0;39m 更新电子书下的文档数据结束，耗时：3毫秒
2021-09-24 15:43:35.007 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377766133879808   [0;39m 生成今日电子书快照开始
2021-09-24 15:43:35.009 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377766133879808   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
2021-09-24 15:43:35.010 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377766133879808   [0;39m ==> Parameters: 
2021-09-24 15:43:35.012 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377766133879808   [0;39m <==    Updates: 0
2021-09-24 15:43:35.013 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :35   [32m377766133879808   [0;39m 生成今日电子书快照结束，耗时：5毫秒
2021-09-24 15:44:00.013 INFO  com.orange_yishenggong.wiki.job.DocJob            :32   [32m377766543578112   [0;39m 更新电子书下的文档数据开始
2021-09-24 15:44:00.014 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377766543578112   [0;39m ==>  Preparing: update ebook t1, (select ebook_id, count(1) doc_count, sum(view_count) view_count, sum(vote_count) vote_count from doc group by ebook_id) t2 set t1.doc_count = t2.doc_count, t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.id = t2.ebook_id
2021-09-24 15:44:00.015 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377766543578112   [0;39m ==> Parameters: 
2021-09-24 15:44:00.016 DEBUG c.o.wiki.mapper.DocMapperCust.updateEbookInfo     :137  [32m377766543578112   [0;39m <==    Updates: 4
2021-09-24 15:44:00.017 INFO  com.orange_yishenggong.wiki.job.DocJob            :35   [32m377766543578112   [0;39m 更新电子书下的文档数据结束，耗时：4毫秒
2021-09-24 15:44:05.014 INFO  com.orange_yishenggong.wiki.job.EbookSnapshotJob  :32   [32m377766625514496   [0;39m 生成今日电子书快照开始
2021-09-24 15:44:05.015 DEBUG c.o.w.mapper.EbookSnapshotMapperCust.genSnapshot  :137  [32m377766625514496   [0;39m ==>  Preparing: -- #snapshot -- #1.generate data for ebooks if there's no existing key set (ebook_id,date) -- #2.update view_count and vote_count -- #3.update view_incr and vote_incr insert into ebook_snapshot(ebook_id, `date`, view_count, vote_count, view_increase, vote_increase) select t1.id, curdate(), 0, 0, 0, 0 from ebook t1 where not exists( select 1 from ebook_snapshot t2 where t1.id = t2.ebook_id and t2.`date` = curdate()); update ebook_snapshot t1,ebook t2 set t1.view_count = t2.view_count, t1.vote_count = t2.vote_count where t1.`date` = curdate() and t1.ebook_id = t2.id; update ebook_snapshot t1 left join (select ebook_id, view_count, vote_count from ebook_snapshot where `date` = date_sub(curdate(), interval 1 day)) t2 on t1.ebook_id = t2.ebook_id set t1.view_increase = t1.view_count - ifnull(t2.view_count, 0), t1.vote_increase = t1.vote_count - ifnull(t2.vote_count, 0) where t1.`date` = curdate();
